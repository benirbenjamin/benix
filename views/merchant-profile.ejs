<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= merchant.business_name || merchant.username %> - Merchant Profile | BenixSpace</title>
  <link rel="icon" href="/static/img/favicon.png" type="image/png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .merchant-header {
      background: linear-gradient(135deg, #0d6efd, #6f42c1);
      color: white;
      padding: 3rem 0;
    }
    .merchant-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      margin: 0 auto 1rem;
    }
    .stats-card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 15px;
      padding: 1.5rem;
      text-align: center;
      margin-bottom: 1rem;
    }
    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    .item-card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .item-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    .time-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 15px;
      font-size: 0.75rem;
    }
    .stats-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      color: white;
      padding: 1rem;
    }
  </style>
</head>
<body class="bg-light">
  <%- include('partials/navbar', { user: user }) %>

  <!-- Merchant Header -->
  <section class="merchant-header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <div class="merchant-avatar">
            <i class="fas fa-store"></i>
          </div>
          <h1 class="mb-2"><%= merchant.business_name || merchant.username %></h1>
          <p class="lead mb-3">
            <i class="fas fa-at me-2"></i><%= merchant.username %>
          </p>
          <% if (merchant.business_description) { %>
            <p class="mb-0"><%= merchant.business_description %></p>
          <% } %>
        </div>
        <div class="col-md-4">
          <div class="row">
            <div class="col-6">
              <div class="stats-card">
                <h3 class="mb-1"><%= merchant.total_links || 0 %></h3>
                <small>Links</small>
              </div>
            </div>
            <div class="col-6">
              <div class="stats-card">
                <h3 class="mb-1"><%= merchant.total_products || 0 %></h3>
                <small>Products</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Content Section -->
  <section class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <h2 class="mb-4">
            <i class="fas fa-store-alt me-2 text-primary"></i>
            <%= merchant.business_name || merchant.username %>'s Collection
          </h2>
          
          <% if (links.length === 0 && products.length === 0) { %>
            <div class="alert alert-info text-center">
              <i class="fas fa-info-circle me-2"></i>
              This merchant hasn't published any content yet.
            </div>
          <% } else { %>
            <div class="content-grid">
              <!-- Links -->
              <% links.forEach(link => { %>
                <div class="item-card position-relative">
                  <div class="time-badge" data-time="<%= link.created_at %>">
                    Loading...
                  </div>
                  
                  <% if (link.type === 'youtube' && link.url) { %>
                    <% 
                      let videoId = '';
                      const youtubeUrl = link.url;
                      const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                      const match = youtubeUrl.match(regex);
                      if (match) {
                        videoId = match[1];
                      }
                    %>
                    <% if (videoId) { %>
                      <div class="position-relative" style="height: 200px;">
                        <img src="https://img.youtube.com/vi/<%= videoId %>/maxresdefault.jpg" 
                             class="w-100 h-100" style="object-fit: cover;" alt="<%= link.title %>">
                        <div class="position-absolute top-50 start-50 translate-middle">
                          <i class="fab fa-youtube text-danger" style="font-size: 3rem;"></i>
                        </div>
                      </div>
                    <% } %>
                  <% } else if (link.image_url) { %>
                    <img src="<%= link.image_url %>" class="w-100" style="height: 200px; object-fit: cover;" alt="<%= link.title %>">
                  <% } else { %>
                    <div class="bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                      <i class="fas fa-link fa-3x text-muted"></i>
                    </div>
                  <% } %>
                  
                  <div class="p-3">
                    <h5 class="card-title mb-2"><%= link.title %></h5>
                    <p class="text-muted small mb-2">
                      <% if (link.description && link.description.length > 100) { %>
                        <%= link.description.substring(0, 100) %>...
                      <% } else { %>
                        <%= link.description || 'No description provided.' %>
                      <% } %>
                    </p>
                    <div class="d-flex justify-content-between align-items-center">
                      <small class="text-muted">
                        <i class="fas fa-mouse-pointer me-1"></i><%= link.total_clicks || 0 %> clicks
                      </small>
                      <span class="badge bg-info"><%= link.type %></span>
                    </div>
                  </div>
                  
                  <div class="card-footer bg-white border-top-0">
                    <a href="/l/<%= link.id %>" class="btn btn-primary w-100">
                      <i class="fas fa-external-link-alt me-1"></i> Visit Link
                    </a>
                  </div>
                </div>
              <% }); %>
              
              <!-- Products -->
              <% products.forEach(product => { %>
                <div class="item-card position-relative">
                  <div class="time-badge" data-time="<%= product.created_at %>">
                    Loading...
                  </div>
                  
                  <% if (product.image_url) { %>
                    <img src="<%= product.image_url %>" class="w-100" style="height: 200px; object-fit: cover;" alt="<%= product.name %>">
                  <% } else { %>
                    <div class="bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                      <i class="fas fa-shopping-bag fa-3x text-muted"></i>
                    </div>
                  <% } %>
                  
                  <div class="p-3">
                    <h5 class="card-title mb-2"><%= product.name %></h5>
                    <p class="text-muted small mb-2">
                      <% if (product.description && product.description.length > 100) { %>
                        <%= product.description.substring(0, 100) %>...
                      <% } else { %>
                        <%= product.description || 'No description available.' %>
                      <% } %>
                    </p>
                    <h5 class="text-success mb-2">$<%= parseFloat(product.price).toFixed(4) %></h5>
                    <span class="badge bg-success">Product</span>
                  </div>
                  
                  <div class="card-footer bg-white border-top-0">
                    <a href="/products/<%= product.id %>" class="btn btn-success w-100">
                      <i class="fas fa-shopping-cart me-1"></i> View Product
                    </a>
                  </div>
                </div>
              <% }); %>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </section>

  <%- include('partials/footer') %>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Function to calculate time ago
    function timeAgo(date) {
      const now = new Date();
      const diff = now - new Date(date);
      
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);
      const weeks = Math.floor(days / 7);
      const months = Math.floor(days / 30);
      const years = Math.floor(days / 365);
      
      if (years > 0) return `${years} year${years > 1 ? 's' : ''} ago`;
      if (months > 0) return `${months} month${months > 1 ? 's' : ''} ago`;
      if (weeks > 0) return `${weeks} week${weeks > 1 ? 's' : ''} ago`;
      if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;
      if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
      if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
      return 'Just now';
    }

    // Update all time badges
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.time-badge').forEach(badge => {
        const time = badge.getAttribute('data-time');
        badge.textContent = timeAgo(time);
      });
    });
  </script>
</body>
</html>
