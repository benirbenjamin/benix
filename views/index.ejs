<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BenixSpace - Affiliate Platform | Transform Social Media Into Profit</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="BenixSpace is the premier affiliate platform that helps you transform your social media presence into profit. Join thousands of successful affiliates today!">
  <meta name="keywords" content="affiliate marketing, social media monetization, make money online, benix, benixspace, affiliate platform">
  <meta name="author" content="BenixSpace">
  <meta name="robots" content="index, follow">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://benix.space/">
  <meta property="og:title" content="BenixSpace - Transform Your Social Media Into Profit">
  <meta property="og:description" content="Join thousands of successful affiliates who are already monetizing their social media presence with BenixSpace.">
  <meta property="og:image" content="https://benix.space/static/img/logo.png">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://benix.space/">
  <meta property="twitter:title" content="BenixSpace - Affiliate Platform">
  <meta property="twitter:description" content="Turn your followers into customers and earn commissions with BenixSpace's affiliate platform.">
  <meta property="twitter:image" content="https://benix.space/static/img/logo.png">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://benix.space/">
  
  <!-- PWA Support -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0d6efd">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="BenixSpace">
  <link rel="apple-touch-icon" href="/static/img/favicon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/static/img/favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/img/favicon.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/static/img/favicon.png">
  
  <link rel="icon" href="/static/img/favicon.png" type="image/png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/static/css/pwa-styles.css">
  
  
  <!-- JSON-LD structured data for better SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "BenixSpace",
    "description": "Transform Your Social Media Presence into Profit",
    "url": "https://benix.space",
    "logo": "https://benix.space/static/img/logo.png",
    "sameAs": [
      "https://facebook.com/benixspace",
      "https://twitter.com/benixspace",
      "https://instagram.com/benixspace"
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+1-800-BENIX-SPACE",
      "contactType": "customer service",
      "availableLanguage": ["English"]
    }
  }
  </script>
  
  <!-- AdSense and Analytics -->
  <%- include('partials/adsense') %>
   <%- include('partials/auto-ads') %>

  <style>    /* Hero Section */
    .hero-section {
      background: linear-gradient(135deg, rgba(13, 110, 253, 0.85), rgba(45, 153, 255, 0.85)),
                  url('https://images.unsplash.com/photo-1557804506-669a67965ba0?auto=format&fit=crop&w=2000&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      align-items: center;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .hero-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.6) 100%);
      z-index: 1;
    }

    .hero-content {
      position: relative;
      z-index: 2;
      text-align: center;
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }

    .hero-badge {
      display: inline-block;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 8px 20px;
      border-radius: 50px;
      margin-bottom: 2rem;
      font-size: 0.9rem;
      font-weight: 500;
      letter-spacing: 0.5px;
      animation: fadeInUp 1s ease-out 0.2s both;
    }

    .hero-title {
      font-size: clamp(2.5rem, 5vw, 4.5rem);
      font-weight: 800;
      margin-bottom: 1.5rem;
      line-height: 1.2;
      text-shadow: 2px 4px 8px rgba(0,0,0,0.3);
      animation: fadeInUp 1s ease-out 0.4s both;
    }

    .hero-title .highlight {
      background: linear-gradient(45deg, #ffffff, #f0f8ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-subtitle {
      font-size: clamp(1.1rem, 2.5vw, 1.4rem);
      opacity: 0.95;
      margin-bottom: 3rem;
      font-weight: 400;
      line-height: 1.6;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      animation: fadeInUp 1s ease-out 0.6s both;
    }

    .hero-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
      animation: fadeInUp 1s ease-out 0.8s both;
    }

    @media (min-width: 576px) {
      .hero-buttons {
        flex-direction: row;
        justify-content: center;
        gap: 1.5rem;
      }
    }

    .hero-stats {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 4rem;
      flex-wrap: wrap;
      animation: fadeInUp 1s ease-out 1s both;
    }

    .hero-stat {
      text-align: center;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 1rem 1.5rem;
      border-radius: 15px;
      min-width: 120px;
    }

    .hero-stat-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: #ffffff;
      display: block;
    }

    .hero-stat-label {
      font-size: 0.85rem;
      opacity: 0.9;
      margin-top: 0.25rem;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Floating animation for decorative elements */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .hero-section::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100px;
      background: linear-gradient(to top, rgba(255,255,255,0.1), transparent);
      z-index: 1;
    }

    /* Features Section */
    .feature-card {
      background: white;
      padding: 40px 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      height: 100%;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .feature-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
    }

    .feature-icon {
      font-size: 3.5rem;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 25px;
    }

    /* Stats Section */
    .stats-section {
      background: linear-gradient(135deg, #2980b9, #2ecc71);
      padding: 80px 0;
      color: white;
      border-radius: 0;
      margin: 60px 0;
    }

    .stat-item {
      text-align: center;
      padding: 30px;
      border-radius: 15px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
    }    .stat-number {
      font-size: 3.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      background: white;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* CTA Section */
    .cta-section {
      background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)),
                  url('https://images.unsplash.com/photo-1552664730-d307ca884978?auto=format&fit=crop&w=2000&q=80');
      background-size: cover;
      background-position: center;
      padding: 100px 0;
      color: white;
      text-align: center;
      border-radius: 0;
    }

    .btn-hero {
      padding: 15px 30px;
      font-size: 1.1rem;
      border-radius: 50px;
      text-transform: none;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
      font-weight: 600;
      border-width: 2px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 180px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .btn-hero:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }

    .btn-light.btn-hero {
      background: linear-gradient(45deg, #ffffff, #f8f9fa);
      color: #0d6efd;
      border-color: rgba(255,255,255,0.8);
    }

    .btn-light.btn-hero:hover {
      background: linear-gradient(45deg, #f8f9fa, #ffffff);
      color: #0d6efd;
      border-color: #ffffff;
    }

    .btn-outline-light.btn-hero {
      background: rgba(255,255,255,0.1);
      color: #ffffff;
      border-color: rgba(255,255,255,0.8);
      backdrop-filter: blur(10px);
    }

    .btn-outline-light.btn-hero:hover {
      background: rgba(255,255,255,0.2);
      color: #ffffff;
      border-color: #ffffff;
    }

    /* PWA Install Button */
    .btn-install-pwa {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 10px 20px;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      animation: bounce 2s infinite;
    }

    .btn-install-pwa:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
      color: white;
    }

    .btn-install-pwa.show {
      display: block;
    }

    @keyframes bounce {
      0%, 20%, 53%, 80%, 100% {
        animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
        transform: translate3d(0, 0, 0);
      }
      40%, 43% {
        animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
        transform: translate3d(0, -5px, 0);
      }
      70% {
        animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
        transform: translate3d(0, -3px, 0);
      }
      90% {
        transform: translate3d(0, -1px, 0);
      }
    }

    /* PWA status indicator */
    .pwa-status {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(40, 167, 69, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      z-index: 1001;
      display: none;
      backdrop-filter: blur(10px);
    }

    .pwa-status.show {
      display: block;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Link cards */
    .link-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .link-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    .link-type-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
    }
    
    .card-img-top {
      height: 200px;
      object-fit: cover;
    }
    
    .popular-tag {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #ff6b6b;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      z-index: 10;
      display: inline-block;
      width: fit-content;
      max-width: none;
      white-space: nowrap;
    }
    
    .shared-tag {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #28a745;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      z-index: 10;
      display: inline-block;
      width: fit-content;
      max-width: none;
      white-space: nowrap;
    }

    /* Product Cards */
    .product-card {
      border: none;
      border-radius: 15px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      background: white;
    }

    .product-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }

    .product-card .card-img-top {
      height: 200px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .product-card:hover .card-img-top {
      transform: scale(1.05);
    }

    .product-card .card-body {
      padding: 1.5rem;
    }

    .product-card .merchant-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255,255,255,0.9);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* Merchant info styling */
    .merchant-info {
      color: #666;
      font-size: 15px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }

    .merchant-info a {
      color: #666;
      text-decoration: none;
      margin-left: 4px;
    }

    .merchant-info a:hover {
      color: #007bff;
    }

    /* Price display styling */
    .price-display {
      font-size: 18px;
      font-weight: 700;
      color: #28a745;
      margin-top: auto;
    }

    /* Engagement stats styling */
    .engagement-stats {
      color: #666;
      font-size: 14px;
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      border-top: 1px solid #f0f0f0;
      padding-top: 8px;
    }

    .engagement-stats span {
      display: flex;
      align-items: center;
      white-space: nowrap;
    }

    .engagement-stats i {
      color: #888;
      font-size: 13px;
    }

    .engagement-stats .user-link {
      color: #666;
      text-decoration: none;
      font-weight: 500;
    }

    .engagement-stats .user-link:hover {
      color: #007bff;
      text-decoration: underline;
    }

    .time-info {
      color: #888 !important;
      font-size: 13px !important;
    }

    .views-info {
      color: #666 !important;
    }

    .target-info {
      color: #28a745 !important;
    }

    /* Time Badge */
    .time-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      z-index: 10;
      font-weight: 500;
    }

    /* Popular Tag */
    .popular-tag {
      position: absolute;
      top: 40px;
      right: 10px;
      background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: bold;
      z-index: 10;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: inline-block;
      width: fit-content;
      max-width: none;
      white-space: nowrap;
    }

    /* Link Type Badge */
    .link-type-badge {
      position: absolute;
      top: 40px;
      right: 10px;
      z-index: 10;
      font-size: 0.65rem;
      padding: 2px 6px;
      text-transform: uppercase;
      font-weight: bold;
      border-radius: 8px;
    }

    /* Link Grid Layout */
    .links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    /* Optimized Card Layout - YouTube Style */
    .content-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 20px;
      max-width: 100%;
      overflow: hidden;
    }

    /* Ensure cards don't exceed grid item width */
    .link-item, .product-item {
      width: 100%;
      max-width: 100%;
      overflow: hidden;
    }

    .link-card, .product-card {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }

    /* Prevent horizontal overflow */
    .container-fluid, .container {
      overflow-x: hidden;
      max-width: 100%;
    }

    .row {
      margin-left: 0;
      margin-right: 0;
      max-width: 100%;
    }

    .col-12 {
      padding-left: 15px;
      padding-right: 15px;
      max-width: 100%;
      overflow: hidden;
    }

    @media (max-width: 1200px) {
      .content-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
    }

    @media (max-width: 768px) {
      .content-grid {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .col-12 {
        padding-left: 10px;
        padding-right: 10px;
      }
    }

    /* YouTube-like Card Design */
    .link-card, .product-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: none;
      border: 1px solid #e1e5e9;
      transition: all 0.2s ease;
      height: auto;
      display: flex;
      flex-direction: column;
      min-width: 0; /* Prevent flex item overflow */
      width: 100%;
    }

    .link-item {
      min-width: 0; /* Prevent grid item overflow */
      width: 100%;
    }

    .link-card:hover, .product-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    /* Card Image - YouTube Style */
    .link-card .card-img-top, .product-card .card-img-top {
      height: 180px;
      object-fit: cover;
      border-radius: 0;
      position: relative;
    }

    /* YouTube Preview Styling */
    .youtube-preview {
      height: 180px;
      border-radius: 0;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s ease;
      background: #000;
      z-index: 1;
    }

    .youtube-preview:hover {
      transform: none;
    }

    .youtube-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .youtube-placeholder {
      position: relative;
      background: linear-gradient(135deg, #000, #333);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      transition: all 0.2s ease;
      cursor: pointer;
      height: 100%;
    }

    .youtube-placeholder:hover {
      background: linear-gradient(135deg, #333, #555);
    }

    /* YouTube Preview Styling - copied from share.ejs */
    .youtube-preview-container {
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s ease;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }

    .youtube-preview-container:hover {
      transform: scale(1.01);
    }

    .youtube-placeholder {
      background: linear-gradient(135deg, #000, #333);
      transition: all 0.3s ease;
      width: 100%;
      height: 100%;
    }

    .youtube-placeholder:hover {
      background: linear-gradient(135deg, #333, #555);
    }

    .youtube-play-button-large {
      width: 60px;
      height: 42px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #ff0000;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .youtube-play-button-large:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.1);
    }

    .youtube-preview-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    @keyframes pulse {
      0% { opacity: 0.8; }
      50% { opacity: 0.4; }
      100% { opacity: 0.8; }
    }

    /* Compact Labels */
    .popular-tag {
      position: absolute;
      top: 8px;
      left: 8px;
      background: #ff6b6b;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      z-index: 10;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: inline-block;
      width: fit-content;
      max-width: none;
      white-space: nowrap;
    }

    /* Link Type Badge - Very Small */
    .link-type-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      z-index: 10;
      font-size: 9px;
      padding: 2px 4px;
      text-transform: uppercase;
      font-weight: 600;
      border-radius: 3px;
      letter-spacing: 0.3px;
    }

    /* Time Badge - Compact */
    .time-badge {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 12px;
      z-index: 10;
      font-weight: 500;
    }

    /* Card Body - Compact */
    .link-card .card-body, .product-card .card-body {
      padding: 12px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .link-card .card-title, .product-card .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      line-height: 1.3;
      color: #1a1a1a;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .link-card .card-text, .product-card .card-text {
      font-size: 15px;
      color: #666;
      margin-bottom: 8px;
      line-height: 1.4;
    }

    .link-card .card-text.small, .product-card .card-text.small {
      font-size: 14px;
    }

    /* Merchant Info */
    .merchant-info {
      font-size: 14px;
      color: #888;
      margin-bottom: 10px;
    }

    .merchant-info a {
      color: #888;
      text-decoration: none;
    }

    .merchant-info a:hover {
      color: #0d6efd;
    }

    /* Engagement Stats */
    .engagement-stats {
      font-size: 13px;
      color: #999;
      margin-top: auto;
    }

    /* Card Footer - Compact */
    .link-card .card-footer, .product-card .card-footer {
      padding: 10px 12px;
      background: transparent;
      border: none;
      margin-top: auto;
    }

    .link-card .card-footer .btn, .product-card .card-footer .btn {
      font-size: 14px;
      padding: 8px 15px;
      border-radius: 6px;
      font-weight: 500;
    }

    /* Price Display */
    .price-display {
      font-size: 16px;
      font-weight: 600;
      color: #059669;
      margin-top: auto;
      margin-bottom: 0;
    }

    /* Engagement Indicators */
    .engagement-stats {
      display: flex;
      gap: 15px;
      margin-top: 15px;
      font-size: 0.9rem;
      color: #6c757d;
    }

    .engagement-stats i {
      color: var(--primary-color);
    }

    /* Category Pills */
    .category-pills {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .category-pill {
      padding: 5px 15px;
      border-radius: 20px;
      background: #f8f9fa;
      color: #495057;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .category-pill:hover,    .category-pill.active {
      background: var(--primary-color);
      color: white;
    }    /* YouTube Preview Styling */
    .youtube-preview {
      border-radius: 8px 8px 0 0;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .youtube-preview:hover {
      transform: scale(1.02);
    }

    .youtube-preview iframe {
      border-radius: 8px 8px 0 0;
    }

    /* Lazy loading placeholder */
    .youtube-placeholder {
      position: relative;
      background: linear-gradient(135deg, #000, #333);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .youtube-placeholder:hover {
      background: linear-gradient(135deg, #333, #555);
      transform: scale(1.02);
    }

    .youtube-play-button {
      width: 68px;
      height: 48px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #ff0000;
      transition: all 0.3s ease;
      cursor: pointer;
      z-index: 2;
      position: relative;
    }

    .youtube-play-button:hover {
      background: white;
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
    }

    .youtube-title-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      color: white;
      padding: 20px 15px 15px;
      font-size: 14px;
      font-weight: 500;
    }

    /* Click indicator */
    .youtube-placeholder::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100px;
      height: 100px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      animation: pulse 2s infinite;
      z-index: 1;
    }

    @keyframes pulse {
      0% {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 0;
      }
    }

    /* Link cards with video preview */
    .link-card .youtube-preview {
      transition: transform 0.3s ease;
    }

    .link-card:hover .youtube-preview {
      transform: scale(1.02);
    }

    /* Loading spinner */
    .youtube-loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }

    .spinner-border-youtube {
      width: 3rem;
      height: 3rem;
      border-width: 4px;
      border-color: #ff0000;
      border-right-color: transparent;
    }

    /* Product Filter Buttons - Mobile Responsive */
    @media (max-width: 768px) {
      .product-filter-buttons, .link-filter-buttons {
        flex-direction: column;
        gap: 10px;
      }
      
      .product-filter-buttons .btn, .link-filter-buttons .btn {
        width: 100%;
        padding: 12px 16px;
        font-size: 16px;
        min-height: 48px;
      }
      
      .product-filter-row .col-md-2:last-child,
      .link-filter-row .col-md-3:last-child {
        margin-top: 15px;
      }
      
      .product-filter-row .col-md-2:last-child .d-flex,
      .link-filter-row .col-md-3:last-child .d-flex {
        flex-direction: column;
        gap: 10px;
      }
    }

    /* Enhanced button styling for better touch targets */
    .btn-apply-filters {
      min-height: 38px;
      font-weight: 500;
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    .btn-apply-filters:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    /* Search form styling */
    .search-form-responsive {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    @media (max-width: 576px) {
      .search-form-responsive .form-control,
      .search-form-responsive .form-select {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 12px 16px;
      }
    }
    
    /* Blog Slider Section */
    .blog-slider-section {
      position: relative;
      overflow: hidden;
    }
    
    .section-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 0;
    }
    
    .section-subtitle {
      font-size: 1.1rem;
      margin-top: 10px;
    }
    
    .blog-slider-container {
      position: relative;
      overflow: hidden;
      border-radius: 20px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .blog-slider {
      display: flex;
      transition: transform 0.5s ease-in-out;
      width: 100%;
    }
    
    .blog-slide {
      min-width: 100%;
      display: none;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    /* Ensure first slide is visible by default */
    .blog-slide:first-child {
      display: block !important;
      opacity: 1 !important;
    }
    
    .blog-slide.active {
      display: block !important;
      opacity: 1 !important;
    }
    
    .blog-slide-card {
      background: #fff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
      height: 500px;
      display: flex;
      flex-direction: column;
    }
    
    .blog-slide-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    }
    
    .blog-slide-image {
      position: relative;
      height: 250px;
      overflow: hidden;
    }
    
    .blog-slide-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .blog-slide-card:hover .blog-slide-image img {
      transform: scale(1.05);
    }
    
    .blog-slide-placeholder {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
    
    .blog-slide-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(0,0,0,0.3), transparent);
      display: flex;
      align-items: flex-end;
      padding: 20px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .blog-slide-card:hover .blog-slide-overlay {
      opacity: 1;
    }
    
    .blog-stats {
      display: flex;
      gap: 15px;
    }
    
    .blog-stat {
      background: rgba(255,255,255,0.9);
      color: #333;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      backdrop-filter: blur(10px);
    }
    
    .blog-slide-content {
      padding: 25px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .blog-slide-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      font-size: 0.85rem;
      color: #666;
    }
    
    .blog-slide-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: #2c3e50;
      line-height: 1.3;
    }
    
    .blog-slide-title a {
      color: inherit;
      transition: color 0.3s ease;
    }
    
    .blog-slide-title a:hover {
      color: #3498db;
    }
    
    .blog-slide-excerpt {
      color: #666;
      line-height: 1.6;
      margin-bottom: 20px;
      flex: 1;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .blog-slide-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
      padding-top: 15px;
      border-top: 1px solid #f0f0f0;
    }
    
    .blog-earnings {
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    .blog-actions {
      display: flex;
      gap: 10px;
    }
    
    .blog-slider-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.9);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: #333;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 10;
      backdrop-filter: blur(10px);
    }
    
    .blog-slider-btn:hover {
      background: #fff;
      color: #3498db;
      transform: translateY(-50%) scale(1.1);
    }
    
    .blog-slider-prev {
      left: 20px;
    }
    
    .blog-slider-next {
      right: 20px;
    }
    
    .blog-slider-dots {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    
    .blog-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ddd;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .blog-dot.active {
      background: #3498db;
      transform: scale(1.2);
    }
    
    /* Responsive Blog Slider */
    @media (max-width: 768px) {
      .section-title {
        font-size: 2rem;
      }
      
      .blog-slide-card {
        height: auto;
        min-height: 450px;
      }
      
      .blog-slide-image {
        height: 200px;
      }
      
      .blog-slide-content {
        padding: 20px;
      }
      
      .blog-slide-title {
        font-size: 1.2rem;
      }
      
      .blog-slide-footer {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
      
      .blog-actions {
        width: 100%;
        justify-content: center;
      }
      
      .blog-slider-btn {
        width: 40px;
        height: 40px;
        font-size: 1rem;
      }
      
      .blog-slider-prev {
        left: 10px;
      }
      
      .blog-slider-next {
        right: 10px;
      }
    }
  </style>
</head>
<body>
  <%- include('partials/navbar') %>

  <!-- Main Content -->
  <div class="container-fluid p-0">
    <% if (typeof user === 'undefined' || !user) { %>
      <!-- Hero Section -->      <section class="hero-section">
        <div class="hero-content">
          <div class="hero-badge">
            <i class="fas fa-rocket me-2"></i>
            Join 10,000+ Successful Affiliates
          </div>
          
          <h1 class="hero-title">
            Transform Your <span class="highlight">Social Media</span> Into Profit
          </h1>
          
          <p class="hero-subtitle">
            Turn your followers into customers and start earning real money with BenixSpace's powerful affiliate platform. Share, earn, and grow your income effortlessly.
          </p>
          
          <div class="hero-buttons">
            <a href="/register" class="btn btn-light btn-hero px-4 py-3">
              <i class="fas fa-user-plus me-2"></i>
              Start Earning Today
            </a>
            <a href="/login" class="btn btn-outline-light btn-hero px-4 py-3">
              <i class="fas fa-sign-in-alt me-2"></i>
              Sign In
            </a>
          </div>
          
          <% if (typeof stats !== 'undefined') { %>
          <div class="hero-stats">
            <div class="hero-stat">
              <span class="hero-stat-number"><%= stats.userCount || 0 %></span>
              <span class="hero-stat-label">Active Users</span>
            </div>
            <div class="hero-stat">
              <span class="hero-stat-number">$<%= typeof stats.totalEarnings !== 'undefined' ? parseFloat(stats.totalEarnings).toFixed(0) : '0' %>+</span>
              <span class="hero-stat-label">Paid Out</span>
            </div>
            <div class="hero-stat">
              <span class="hero-stat-number"><%= stats.totalLinks || 0 %></span>
              <span class="hero-stat-label">Active Links</span>
            </div>
          </div>
          <% } %>
        </div>
      </section>
      
      <!-- Sliding Blog Posts Section -->
      <section class="blog-slider-section py-5 bg-light">
        <div class="container">
          <div class="row align-items-center mb-4">
            <div class="col-md-8">
              <h2 class="section-title">
                <i class="fas fa-blog me-3 text-primary"></i>
                Featured Blog Posts
              </h2>
              <p class="section-subtitle text-muted">
                Discover engaging content from our community and earn by sharing
              </p>
            </div>
            <div class="col-md-4 text-end">
              <a href="/blog" class="btn btn-primary btn-lg rounded-pill">
                <i class="fas fa-arrow-right me-2"></i>View All Posts
              </a>
            </div>
          </div>
          
          <!-- Blog Posts Slider -->
          <div class="blog-slider-container">
            <div class="blog-slider" id="blogSlider">
              <% if (typeof blogPosts !== 'undefined' && blogPosts && blogPosts.length > 0) { %>
                <% blogPosts.forEach(post => { %>
                  <div class="blog-slide">
                    <a href="/blog/<%= post.slug %>" class="text-decoration-none">
                      <div class="blog-slide-card">
                        <!-- Blog Image -->
                        <div class="blog-slide-image">
                          <% if (post.featured_image) { %>
                            <img src="<%= post.featured_image %>" alt="<%= post.title %>" loading="lazy">
                          <% } else { %>
                            <div class="blog-slide-placeholder">
                              <i class="fas fa-blog fa-3x text-primary"></i>
                            </div>
                          <% } %>
                          <div class="blog-slide-overlay">
                            <div class="blog-stats">
                              <span class="blog-stat">
                                <i class="fas fa-eye"></i> <%= post.view_count || 0 %>
                              </span>
                              <span class="blog-stat">
                                <i class="fas fa-mouse-pointer"></i> <%= post.click_count || 0 %>
                              </span>
                              <span class="blog-stat">
                                <i class="fas fa-share"></i> <%= post.share_count || 0 %>
                              </span>
                            </div>
                          </div>
                        </div>
                        
                        <!-- Blog Content -->
                        <div class="blog-slide-content">
                          <div class="blog-slide-meta">
                            <span class="blog-author">
                              <i class="fas fa-user me-1"></i>
                              <%= post.author_name %>
                            </span>
                            <span class="blog-date">
                              <i class="fas fa-calendar me-1"></i>
                              <%= post.created_at ? new Date(post.created_at).toLocaleDateString() : 'Unknown date' %>
                            </span>
                          </div>
                          
                          <h3 class="blog-slide-title">
                            <%= post.title %>
                          </h3>
                          
                          <p class="blog-slide-excerpt">
                            <%= post.description && post.description !== 'No preview available' ? post.description.replace(/<[^>]*>/g, '').substring(0, 100) + '...' : (post.excerpt || 'No preview available') %>
                          </p>
                          
                          <div class="blog-slide-footer">
                            <div class="blog-earnings">
                              <i class="fas fa-dollar-sign text-success me-1"></i>
                              <span class="text-success fw-bold">
                                $<%= (parseFloat(post.cpc || 0.006) * (userCommissionPercentage || 30) / 100).toFixed(4) %> per click
                              </span>
                            </div>
                            
                            <div class="blog-actions">
                              <span class="btn btn-primary btn-sm rounded-pill">
                                <i class="fas fa-book-open me-1"></i>Read
                              </span>
                              <% if (user) { %>
                                <button class="btn btn-success btn-sm rounded-pill ms-2" 
                                        onclick="event.preventDefault(); event.stopPropagation(); sharePost(<%= post.id %>, '<%= post.title %>', '<%= post.slug %>')">
                                  <i class="fas fa-share me-1"></i>Share
                                </button>
                              <% } %>
                            </div>
                          </div>
                        </div>
                      </div>
                    </a>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="blog-slide">
                  <div class="blog-slide-card text-center p-5">
                    <i class="fas fa-blog fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">No blog posts yet</h4>
                    <p class="text-muted">Check back soon for amazing content!</p>
                    <a href="/blog" class="btn btn-primary rounded-pill">
                      <i class="fas fa-plus me-2"></i>Be the first to post
                    </a>
                  </div>
                </div>
              <% } %>
            </div>
            
            <!-- Slider Navigation -->
            <button class="blog-slider-btn blog-slider-prev" onclick="slideBlog(-1)">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="blog-slider-btn blog-slider-next" onclick="slideBlog(1)">
              <i class="fas fa-chevron-right"></i>
            </button>
            
            <!-- Slider Dots -->
            <div class="blog-slider-dots" id="blogSliderDots">
              <!-- Dots will be generated by JavaScript -->
            </div>
          </div>
        </div>
      </section>
      
      <!-- Products and Links Section -->
      <section class="container">
        <div class="text-center mb-5">
          <h2 class="section-heading text-center">Discover Our Content</h2>
          <p class="text-muted">Browse through our latest links and products - Login or register to start earning!</p>
        </div>

        <!-- Unified Search -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card search-form-responsive">
              <div class="card-body py-3">
                <div class="row g-3 align-items-end">
                  <div class="col-md-8">
                    <label class="form-label">Search Content</label>
                    <input type="text" class="form-control" id="unifiedSearch" placeholder="Search links, products, merchants...">
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="contentTypeFilter">
                      <option value="all">All Content</option>
                      <option value="links">Links Only</option>
                      <option value="products">Products Only</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label d-none d-md-block">&nbsp;</label>
                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-primary" id="searchBtn">
                        <i class="fas fa-search me-1"></i><span class="d-none d-md-inline">Search</span>
                      </button>
                      <button type="button" class="btn btn-outline-secondary" id="clearBtn">
                        <i class="fas fa-times"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Unified Content Grid -->
        <div class="row">
          <!-- Most Viewed Links Section -->
          <div class="col-12 mb-5">
            <h3 class="text-danger mb-3">
              <i class="fas fa-fire me-2"></i>Most Viewed Links
              <small class="text-muted ms-2">(Highest Views)</small>
            </h3>
            <div class="content-grid" id="mostViewedLinksContainer">
              <% if (typeof popularVideos !== 'undefined' && popularVideos && popularVideos.length > 0) { %>
                <% popularVideos.forEach((video, index) => { %>
                  <% 
                    // Extract YouTube video ID from URL if available
                    let videoId = '';
                    if (video.url) {
                      const youtubeUrl = video.url;
                      const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                      const match = youtubeUrl.match(regex);
                      if (match) {
                        videoId = match[1];
                      }
                    }
                  %>
                  <div class="link-item">
                    <div class="card link-card">
                      <div class="popular-tag">🔥 Popular</div>
                      <span class="link-type-badge badge bg-danger">
                        <%= video.type || 'link' %>
                      </span>
                      <% if (video.url) { %>
                        <% if (videoId) { %>
                          <div class="youtube-preview-container" 
                               style="position: relative; width: 100%; height: 180px; background: #000; border-radius: 0;"
                               data-video-id="<%= videoId %>"
                               data-video-title="<%= video.title %>">
                            <div class="youtube-placeholder d-flex flex-column align-items-center justify-content-center h-100 text-white" style="cursor: pointer;">
                              <div class="youtube-play-button-large mb-2">
                                <i class="fab fa-youtube" style="font-size: 2rem; color: #ff0000;"></i>
                              </div>
                              <p class="text-center text-muted px-2 mb-0" style="font-size: 11px;">Click to load and watch</p>
                            </div>
                          </div>
                        <% } else { %>
                          <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
                            <div class="text-center text-white">
                              <i class="fab fa-youtube fa-2x text-danger mb-2"></i>
                              <p class="mb-0 small">Invalid URL</p>
                            </div>
                          </div>
                        <% } %>
                      <% } else { %>
                        <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
                          <i class="fab fa-youtube fa-2x text-danger"></i>
                        </div>
                      <% } %>
                      <div class="card-body">
                        <h5 class="card-title"><%= video.title %></h5>
                        <div class="merchant-info">
                          <i class="fas fa-user-tie me-1"></i>
                          <a href="/merchants/<%= video.username %>">
                            <%= video.business_name || video.merchant_name %>
                          </a>
                        </div>
                        <% if (video.description) { %>
                          <p class="card-text small">
                            <% if (video.description.length > 50) { %>
                              <%= video.description.substring(0, 50) %>...
                            <% } else { %>
                              <%= video.description %>
                            <% } %>
                          </p>
                        <% } %>
                        <div class="engagement-stats">
                          <span class="time-info" data-time="<%= video.created_at %>">
                            <i class="fas fa-clock me-1"></i>Loading...
                          </span>
                          <span class="views-info">
                            <i class="fas fa-eye me-1"></i><%= video.clicks_count || 0 %> views
                          </span>
                          <span class="user-info">
                            <i class="fas fa-user me-1"></i>
                            <a href="/user/<%= video.username %>" class="user-link">
                              <%= video.business_name || video.merchant_name %>
                            </a>
                          </span>
                          <% if (video.click_target) { %>
                            <span class="target-info">
                              <i class="fas fa-target me-1"></i>Target <%= video.click_target %>
                            </span>
                          <% } %>
                        </div>
                      </div>
                      <div class="card-footer">
                        <% if (user) { %>
                          <% if (videoId) { %>
                            <a href="/links/<%= video.id %>/share" class="btn btn-danger w-100">
                              <i class="fas fa-share-alt me-1"></i> Share & Earn
                            </a>
                          <% } else { %>
                            <a href="/links/<%= video.id %>/share" class="btn btn-danger w-100">
                              <i class="fas fa-external-link-alt me-1"></i> Share & Earn
                            </a>
                          <% } %>
                        <% } else { %>
                          <% if (videoId) { %>
                            <a href="/links/<%= video.id %>/share" class="btn btn-outline-danger w-100">
                              <i class="fas fa-share-alt me-1"></i> Share & Earn
                            </a>
                          <% } else { %>
                            <a href="/links/<%= video.id %>/share" class="btn btn-outline-danger w-100">
                              <i class="fas fa-external-link-alt me-1"></i> Share & Earn
                              
                            </a>
                          <% } %>
                        <% } %>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="col-12">
                  <div class="alert alert-info">
                    <i class="fas fa-fire me-2"></i> No popular links available yet.
                  </div>
                </div>
              <% } %>
            </div>
          </div>

          <!-- Recent Links Section -->
          <div class="col-12 mb-5">
            <h3 class="text-success mb-3">
              <i class="fas fa-clock me-2"></i>Recently Posted
              <small class="text-muted ms-2">(Latest Links)</small>
            </h3>
            <div class="content-grid" id="recentLinksContainer">
              <% if (typeof recentLinks !== 'undefined' && recentLinks && recentLinks.length > 0) { %>
                <% recentLinks.forEach((link, index) => { %>
                  <% 
                    // Extract YouTube video ID from URL if available
                    let videoId = '';
                    if (link.type === 'youtube' && link.url) {
                      const youtubeUrl = link.url;
                      const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                      const match = youtubeUrl.match(regex);
                      if (match) {
                        videoId = match[1];
                      }
                    }
                  %>
                  <div class="link-item">
                    <div class="card link-card">
                      <div class="popular-tag">🆕 New</div>
                      <span class="link-type-badge badge <%= 
                        link.type === 'product' ? 'bg-primary' : 
                        link.type === 'youtube' ? 'bg-danger' : 
                        'bg-info' %>">
                        <%= link.type %>
                      </span>
                      <% if (link.type === 'youtube' && link.url) { %>
                        <% if (videoId) { %>
                          <div class="youtube-preview-container" 
                               style="position: relative; width: 100%; height: 180px; background: #000; border-radius: 0;"
                               data-video-id="<%= videoId %>"
                               data-video-title="<%= link.title %>">
                            <div class="youtube-placeholder d-flex flex-column align-items-center justify-content-center h-100 text-white" style="cursor: pointer;">
                              <div class="youtube-play-button-large mb-2">
                                <i class="fab fa-youtube" style="font-size: 2rem; color: #ff0000;"></i>
                              </div>
                              <p class="text-center text-muted px-2 mb-0" style="font-size: 11px;">Click to load and watch</p>
                            </div>
                          </div>
                        <% } else { %>
                          <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
                            <div class="text-center text-white">
                              <i class="fab fa-youtube fa-2x text-danger mb-2"></i>
                              <p class="mb-0 small">Invalid URL</p>
                            </div>
                          </div>
                        <% } %>
                      <% } else if (link.image_url) { %>
                        <img src="<%= link.image_url %>" class="card-img-top" alt="<%= link.title %>" style="height: 180px; object-fit: cover;">
                      <% } else { %>
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                          <i class="<%= 
                            link.type === 'product' ? 'fas fa-shopping-bag' : 
                            link.type === 'youtube' ? 'fab fa-youtube' : 
                            'fas fa-link' %> fa-2x text-muted"></i>
                        </div>
                      <% } %>
                      <div class="card-body">
                        <h5 class="card-title"><%= link.title %></h5>
                        <div class="merchant-info">
                          <i class="fas fa-user-tie me-1"></i>
                          <a href="/merchants/<%= link.username %>">
                            <%= link.business_name || link.merchant_name %>
                          </a>
                        </div>
                        <% if (link.description) { %>
                          <p class="card-text small">
                            <% if (link.description.length > 50) { %>
                              <%= link.description.substring(0, 50) %>...
                            <% } else { %>
                              <%= link.description %>
                            <% } %>
                          </p>
                        <% } %>
                        <div class="engagement-stats">
                          <span class="time-info" data-time="<%= link.created_at %>">
                            <i class="fas fa-clock me-1"></i>Loading...
                          </span>
                          <span class="views-info">
                            <i class="fas fa-eye me-1"></i><%= link.clicks_count || 0 %> views
                          </span>
                          <span class="user-info">
                            <i class="fas fa-user me-1"></i>
                            <a href="/user/<%= link.username %>" class="user-link">
                              <%= link.business_name || link.merchant_name %>
                            </a>
                          </span>
                          <% if (link.click_target) { %>
                            <span class="target-info">
                              <i class="fas fa-target me-1"></i>Target <%= link.click_target %>
                            </span>
                          <% } %>
                        </div>
                      </div>
                      <div class="card-footer">
                        <% if (user) { %>
                          <a href="/links/<%= link.id %>/share" class="btn btn-primary w-100">
                            <i class="fas fa-external-link-alt me-1"></i> Share & Earn
                          </a>
                        <% } else { %>
                          <a href="/links/<%= link.id %>/share" class="btn btn-outline-primary w-100">
                            <i class="fas fa-external-link-alt me-1"></i> Share & Earn
                          </a>
                        <% } %>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="col-12">
                  <div class="alert alert-info">
                    <i class="fas fa-clock me-2"></i> No recent links available.
                  </div>
                </div>
              <% } %>
            </div>
          </div>

          <!-- More Links Section -->
          <div class="col-12 mb-5">
            <h3 class="text-primary mb-3">
              <i class="fas fa-link me-2"></i>More Links
            </h3>
            <div class="content-grid" id="linksContainer">
              <% if (links && links.length > 0) { %>
                <% links.slice(0, 14).forEach((link, index) => { %>
                  <div class="link-item">
                    <div class="card link-card">
                      <% if (index < 3) { %>
                        <div class="popular-tag">Popular</div>
                      <% } %>
                      <span class="link-type-badge badge <%= 
                        link.type === 'product' ? 'bg-primary' : 
                        link.type === 'youtube' ? 'bg-danger' : 
                        'bg-info' %>">
                        <%= link.type %>
                      </span>
                      <% if (link.type === 'youtube' && link.url) { %>
                        <% 
                          let videoId = '';
                          const youtubeUrl = link.url;
                          const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                          const match = youtubeUrl.match(regex);
                          if (match) {
                            videoId = match[1];
                          }
                        %>
                        <% if (videoId) { %>
                          <div class="youtube-preview-container" 
                               style="position: relative; width: 100%; height: 180px; background: #000; border-radius: 0;"
                               data-video-id="<%= videoId %>"
                               data-video-title="<%= link.title %>">
                            <div class="youtube-placeholder d-flex flex-column align-items-center justify-content-center h-100 text-white" style="cursor: pointer;">
                              <div class="youtube-play-button-large mb-2">
                                <i class="fab fa-youtube" style="font-size: 2rem; color: #ff0000;"></i>
                              </div>
                              <p class="text-center text-muted px-2 mb-0" style="font-size: 11px;">Click to load and watch</p>
                            </div>
                          </div>
                        <% } else { %>
                          <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
                            <div class="text-center text-white">
                              <i class="fab fa-youtube fa-2x text-danger mb-2"></i>
                              <p class="mb-0 small">Invalid URL</p>
                            </div>
                          </div>
                        <% } %>
                      <% } else if (link.image_url) { %>
                        <img src="<%= link.image_url %>" class="card-img-top" alt="<%= link.title %>" style="height: 180px; object-fit: cover;">
                      <% } else { %>
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                          <i class="<%= 
                            link.type === 'product' ? 'fas fa-shopping-bag' : 
                            link.type === 'youtube' ? 'fab fa-youtube' : 
                            'fas fa-link' %> fa-2x text-muted"></i>
                        </div>
                      <% } %>
                      <div class="card-body">
                        <h5 class="card-title"><%= link.title %></h5>
                        <div class="merchant-info">
                          <i class="fas fa-user-tie me-1"></i>
                          <a href="/merchants/<%= link.username %>">
                            <%= link.business_name || link.merchant_name %>
                          </a>
                        </div>
                        <% if (link.description) { %>
                          <p class="card-text small">
                            <% if (link.description.length > 50) { %>
                              <%= link.description.substring(0, 50) %>...
                            <% } else { %>
                              <%= link.description %>
                            <% } %>
                          </p>
                        <% } %>
                        <div class="engagement-stats">
                          <span class="time-info" data-time="<%= link.created_at %>">
                            <i class="fas fa-clock me-1"></i>Loading...
                          </span>
                          <span class="views-info">
                            <i class="fas fa-eye me-1"></i><%= link.clicks_count || 0 %> views
                          </span>
                          <span class="user-info">
                            <i class="fas fa-user me-1"></i>
                            <a href="/user/<%= link.username %>" class="user-link">
                              <%= link.business_name || link.merchant_name %>
                            </a>
                          </span>
                          <% if (link.click_target) { %>
                            <span class="target-info">
                              <i class="fas fa-target me-1"></i>Target <%= link.click_target %>
                            </span>
                          <% } %>
                        </div>
                      </div>
                      <div class="card-footer">
                        <% if (user) { %>
                          <a href="/links/<%= link.id %>/share" class="btn btn-primary w-100">
                            <i class="fas fa-external-link-alt me-1"></i> Share & Earn
                          </a>
                        <% } else { %>
                          <a href="/links/<%= link.id %>/share" class="btn btn-outline-primary w-100">
                            <i class="fas fa-external-link-alt me-1"></i> Share & Earn
                          </a>
                        <% } %>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="col-12">
                  <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> No links available at the moment.
                  </div>
                </div>
              <% } %>
            </div>
            
            <% if (links && links.length > 14) { %>
              <div class="text-center mt-4">
                <button type="button" class="btn btn-outline-primary" id="loadMoreLinks">
                  <i class="fas fa-plus me-1"></i> Load More Links
                </button>
              </div>
            <% } %>
          </div>

          <!-- Products Section -->
          <div class="col-12 mb-5">
            <h3 class="text-success mb-3">
              <i class="fas fa-shopping-bag me-2"></i>Latest Products
            </h3>
            <div class="content-grid" id="productsContainer">
              <% if (products && products.length > 0) { %>
                <% products.slice(0, 14).forEach((product, index) => { %>
                  <div class="product-item">
                    <div class="card product-card">
                      <% if (index < 2) { %>
                        <div class="popular-tag">Hot</div>
                      <% } %>
                      <% if (product.image_url) { %>
                        <img src="<%= product.image_url %>" class="card-img-top" alt="<%= product.name %>" style="height: 180px; object-fit: cover;">
                      <% } else { %>
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                          <i class="fas fa-shopping-bag fa-2x text-muted"></i>
                        </div>
                      <% } %>
                      <div class="card-body">
                        <h5 class="card-title"><%= product.name %></h5>
                        <div class="merchant-info">
                          <i class="fas fa-user-tie me-1"></i>
                          <a href="/merchants/<%= product.username %>">
                            <%= product.merchant_name %>
                          </a>
                        </div>
                        <% if (product.description) { %>
                          <p class="card-text small">
                            <% if (product.description.length > 50) { %>
                              <%= product.description.substring(0, 50) %>...
                            <% } else { %>
                              <%= product.description %>
                            <% } %>
                          </p>
                        <% } %>
                        <div class="price-display">$<%= parseFloat(product.price).toFixed(2) %></div>
                        <div class="engagement-stats">
                          <span class="time-info" data-time="<%= product.created_at %>">
                            <i class="fas fa-clock me-1"></i>Loading...
                          </span>
                          <span class="user-info">
                            <i class="fas fa-user me-1"></i>
                            <a href="/user/<%= product.username %>" class="user-link">
                              <%= product.merchant_name %>
                            </a>
                          </span>
                        </div>
                      </div>
                      <div class="card-footer">
                        <a href="/products/<%= product.id %>" class="btn btn-success w-100">
                          <i class="fas fa-shopping-cart me-1"></i> View Product
                        </a>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="col-12">
                  <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> No products available at the moment.
                  </div>
                </div>
              <% } %>
            </div>
            
            <% if (products && products.length > 14) { %>
              <div class="text-center mt-4">
                <button type="button" class="btn btn-outline-success" id="loadMoreProducts">
                  <i class="fas fa-plus me-1"></i> Load More Products
                </button>
              </div>
            <% } %>
          </div>
        </div>
      </section>

      <!-- Features Section -->
      <section class="features-section">
        <div class="container">
          <h2 class="text-center mb-5">Why Choose BenixSpace?</h2>
          <div class="row">
            <div class="col-md-4 mb-4">
              <div class="feature-card">
                <i class="fas fa-money-bill-wave feature-icon"></i>
                <h3>Earn Money</h3>
                <p>Turn your social media influence into real income with our affiliate program</p>
              </div>
            </div>
            <div class="col-md-4 mb-4">
              <div class="feature-card">
                <i class="fas fa-link feature-icon"></i>
                <h3>Easy Sharing</h3>
                <p>Share products and content with just one click across all platforms</p>
              </div>
            </div>
            <div class="col-md-4 mb-4">
              <div class="feature-card">
                <i class="fas fa-chart-line feature-icon"></i>
                <h3>Track Progress</h3>
                <p>Monitor your earnings and performance with detailed analytics</p>
              </div>
            </div>
          </div>
        </div>
      </section>

    <!-- Stats Section with Real Database Data -->
      <section class="stats-section">
        <div class="container">
          <div class="row">            <div class="col-md-3 mb-4">
              <div class="stat-item">
                <div class="stat-icon mb-3">
                  <i class="fas fa-users fa-2x"></i>
                </div>                <div class="stat-number"><%= typeof stats !== 'undefined' && stats.userCount ? stats.userCount : 0 %></div>
                <div>Active Users</div>
              </div>
            </div>
            <div class="col-md-3 mb-4">
              <div class="stat-item">
                <div class="stat-icon mb-3">
                  <i class="fas fa-link fa-2x"></i>
                </div>
                <div class="stat-number"><%= typeof stats !== 'undefined' && stats.totalLinks ? stats.totalLinks : 0 %></div>
                <div>Active Links</div>
              </div>
            </div>
            <div class="col-md-3 mb-4">
              <div class="stat-item">
                <div class="stat-icon mb-3">
                  <i class="fas fa-mouse-pointer fa-2x"></i>
                </div>
                <div class="stat-number"><%= typeof stats !== 'undefined' && stats.clickCount ? stats.clickCount : 0 %></div>
                <div>Total Clicks</div>
              </div>
            </div>
            <div class="col-md-3 mb-4">
              <div class="stat-item">
                <div class="stat-icon mb-3">
                  <i class="fas fa-dollar-sign fa-2x"></i>
                </div>
                <div class="stat-number">$<%= typeof stats !== 'undefined' && stats.totalEarnings ? parseFloat(stats.totalEarnings).toFixed(4) : '0.00' %></div>
                <div>Paid to Affiliates</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Featured Merchants Section -->
      <section class="container my-5">
        <h2 class="text-center mb-5">Featured Merchants</h2>
        <div class="row">
          <% if (merchants && merchants.length > 0) { %>
            <% merchants.forEach(merchant => { %>
              <div class="col-md-4 mb-4">
                <div class="card h-100 shadow">
                  <div class="card-body text-center">
                    <div class="display-4 mb-3">
                      <div class="user-avatar d-inline-flex align-items-center justify-content-center rounded-circle bg-primary text-white" style="width: 80px; height: 80px; font-size: 2rem;">
                        <%= merchant.username.charAt(0).toUpperCase() %>
                      </div>
                    </div>
                    <h5 class="card-title"><%= merchant.business_name || merchant.username %></h5>
                    <p class="card-text">
                      <% if (merchant.business_description && merchant.business_description.length > 100) { %>
                        <%= merchant.business_description.substring(0, 100) %>...
                      <% } else { %>
                        <%= merchant.business_description || 'Trusted merchant on BenixSpace' %>
                      <% } %>
                    </p>
                    <p class="text-muted">
                      <small>
                        <i class="fas fa-link me-1"></i> <%= merchant.product_count || 0 %> products
                        <i class="fas fa-users ms-3 me-1"></i> Joined <%= merchant.formatted_join_date || 'recently' %>
                      </small>
                    </p>
                  </div>
                </div>
              </div>
            <% }); %>
          <% } else { %>
            <div class="col-12">
              <div class="alert alert-info">No merchants available yet.</div>
            </div>
          <% } %>
        </div>
      </section>

      <!-- About Us Section -->
      <section class="cta-section">
        <div class="container">
          <h2 class="mb-4">More about us</h2>
          <p class="mb-4">BenixSpace is a platform by NebeluRw a company based in Rwanda, Kigali.
            NebeluRw aims at developing softwares that changes life. NebeluRw does various activies
            including but not limited to web design, digital marketing, software development,
          Music production and so on. 
        BenixSpace is here to help people earn online by sharing links. Enjoy!
        </p>
          <a href="/register" class="btn btn-light btn-hero">Start Now</a>
        </div>
      </section>
      
      <!-- CTA Section -->
      <section class="cta-section">
        <div class="container">
          <h2 class="mb-4">Ready to Start Earning?</h2>
          <p class="mb-4">Join thousands of successful affiliates on BenixSpace</p>
          <a href="/register" class="btn btn-light btn-hero">Start Now</a>
        </div>
      </section>
    <% } else { %>
      <!-- Show available content for logged in users -->
      <div class="container mt-5">
        <div class="row mb-4">
          <div class="col-md-8">
            <h2>Available Content</h2>
            <p class="text-muted">Share these links and browse products to earn commission</p>
          </div>
          <div class="col-md-4 text-md-end">
            <% if (typeof stats !== 'undefined') { %>
              <div class="border rounded p-3 text-center">
                <h5 class="m-0">Platform Stats</h5>
                <div class="d-flex justify-content-between mt-2">
                  <div>
                    <small class="d-block text-muted">Users</small>
                    <span class="fw-bold"><%= stats.userCount || 0 %></span>
                  </div>
                  <div>
                    <small class="d-block text-muted">Clicks</small>
                    <span class="fw-bold"><%= stats.clickCount || 0 %></span>
                  </div>
                  <div>
                    <small class="d-block text-muted">Links</small>
                    <span class="fw-bold"><%= stats.totalLinks || 0 %></span>
                  </div>
                </div>
              </div>
            <% } %>
          </div>
        </div>
      </div>

      <!-- Blog Posts Slider for Logged In Users -->
      <section class="blog-slider-section py-5 bg-light">
        <div class="container">
          <div class="row align-items-center mb-4">
            <div class="col-md-8">
              <h2 class="section-title">
                <i class="fas fa-blog me-3 text-primary"></i>
                Featured Blog Posts
              </h2>
              <p class="section-subtitle text-muted">
                Discover engaging content from our community and earn by sharing
              </p>
            </div>
            <div class="col-md-4 text-end">
              <a href="/blog" class="btn btn-primary btn-lg rounded-pill">
                <i class="fas fa-arrow-right me-2"></i>View All Posts
              </a>
            </div>
          </div>
          
          <!-- Blog Posts Slider -->
          <div class="blog-slider-container">
            <div class="blog-slider" id="blogSliderLoggedIn">
              <% if (typeof blogPosts !== 'undefined' && blogPosts && blogPosts.length > 0) { %>
                <% blogPosts.forEach(post => { %>
                  <div class="blog-slide">
                    <a href="/blog/<%= post.slug %>" class="text-decoration-none">
                      <div class="blog-slide-card">
                        <!-- Blog Image -->
                        <div class="blog-slide-image">
                          <% if (post.featured_image) { %>
                            <img src="<%= post.featured_image %>" alt="<%= post.title %>" loading="lazy">
                          <% } else { %>
                            <div class="blog-slide-placeholder">
                              <i class="fas fa-blog fa-3x text-primary"></i>
                            </div>
                          <% } %>
                          <div class="blog-slide-overlay">
                            <div class="blog-stats">
                              <span class="blog-stat">
                                <i class="fas fa-eye"></i> <%= post.view_count || 0 %>
                              </span>
                              <span class="blog-stat">
                                <i class="fas fa-mouse-pointer"></i> <%= post.click_count || 0 %>
                              </span>
                              <span class="blog-stat">
                                <i class="fas fa-share"></i> <%= post.share_count || 0 %>
                              </span>
                            </div>
                          </div>
                        </div>
                        
                        <!-- Blog Content -->
                        <div class="blog-slide-content">
                          <div class="blog-slide-meta">
                            <span class="blog-author">
                              <i class="fas fa-user me-1"></i>
                              <%= post.author_name %>
                            </span>
                            <span class="blog-date">
                              <i class="fas fa-calendar me-1"></i>
                              <%= post.created_at ? new Date(post.created_at).toLocaleDateString() : 'Unknown date' %>
                            </span>
                          </div>
                          
                          <h3 class="blog-slide-title">
                            <%= post.title %>
                          </h3>
                          
                          <p class="blog-slide-excerpt">
                            <%= post.description && post.description !== 'No preview available' ? post.description.replace(/<[^>]*>/g, '').substring(0, 100) + '...' : (post.excerpt || 'No preview available') %>
                          </p>
                          
                          <div class="blog-slide-footer">
                            <div class="blog-earnings">
                              <i class="fas fa-dollar-sign text-success me-1"></i>
                              <span class="text-success fw-bold">
                                $<%= (parseFloat(post.cpc || 0.006) * (userCommissionPercentage || 30) / 100).toFixed(4) %> per click
                              </span>
                            </div>
                            
                            <div class="blog-actions">
                              <span class="btn btn-primary btn-sm rounded-pill">
                                <i class="fas fa-book-open me-1"></i>Read
                              </span>
                              <button class="btn btn-success btn-sm rounded-pill ms-2" 
                                      onclick="event.preventDefault(); event.stopPropagation(); sharePost(<%= post.id %>, '<%= post.title %>', '<%= post.slug %>')">
                                <i class="fas fa-share me-1"></i>Share
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </a>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="blog-slide">
                  <div class="blog-slide-card text-center p-5">
                    <i class="fas fa-blog fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">No blog posts yet</h4>
                    <p class="text-muted">Check back soon for amazing content!</p>
                    <a href="/blog" class="btn btn-primary rounded-pill">
                      <i class="fas fa-plus me-2"></i>Be the first to post
                    </a>
                  </div>
                </div>
              <% } %>
            </div>
            
            <!-- Slider Navigation -->
            <button class="blog-slider-btn blog-slider-prev" onclick="slideBlogLoggedIn(-1)">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="blog-slider-btn blog-slider-next" onclick="slideBlogLoggedIn(1)">
              <i class="fas fa-chevron-right"></i>
            </button>
            
            <!-- Slider Dots -->
            <div class="blog-slider-dots" id="blogSliderDotsLoggedIn">
              <!-- Dots will be generated by JavaScript -->
            </div>
          </div>
        </div>
      </section>

      <div class="container">
        
        <!-- Most Viewed Links Section for Logged In Users -->
        <div class="row mb-5">
          <div class="col-12">
            <h3 class="text-danger mb-3">
              <i class="fas fa-fire me-2"></i>Most Viewed Links
              <small class="text-muted ms-2">(Top 3 by Views)</small>
            </h3>
            <div class="content-grid" id="mostViewedLinksContainerLoggedIn">
              <% if (lazyLoad) { %>
                <!-- Loading placeholders for lazy loading -->
                <div class="loading-placeholder">
                  <div class="card">
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="placeholder-glow">
                        <span class="placeholder col-7"></span>
                        <span class="placeholder col-4"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="loading-placeholder">
                  <div class="card">
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="placeholder-glow">
                        <span class="placeholder col-7"></span>
                        <span class="placeholder col-4"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="loading-placeholder">
                  <div class="card">
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="placeholder-glow">
                        <span class="placeholder col-7"></span>
                        <span class="placeholder col-4"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                    </div>
                  </div>
                </div>
              <% } else if (typeof popularVideos !== 'undefined' && popularVideos && popularVideos.length > 0) { %>
                <% popularVideos.slice(0, 3).forEach((video, index) => { %>
                  <% 
                    let videoId = '';
                    if (video.url) {
                      const youtubeUrl = video.url;
                      const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                      const match = youtubeUrl.match(regex);
                      if (match) {
                        videoId = match[1];
                      }
                    }
                  %>
                  <div class="link-item">
                    <div class="card link-card">
                      <div class="popular-tag">🔥 Popular</div>
                      <span class="link-type-badge badge bg-danger">
                        <%= video.type || 'link' %>
                      </span>
                      <% if (video.url) { %>
                        <% if (videoId) { %>
                          <div class="youtube-preview-container" 
                               style="position: relative; width: 100%; height: 180px; background: #000; border-radius: 0;"
                               data-video-id="<%= videoId %>"
                               data-video-title="<%= video.title %>">
                            <div class="youtube-placeholder d-flex flex-column align-items-center justify-content-center h-100 text-white" style="cursor: pointer;">
                              <div class="youtube-play-button-large mb-2">
                                <i class="fab fa-youtube" style="font-size: 2rem; color: #ff0000;"></i>
                              </div>
                              <p class="text-center text-muted px-2 mb-0" style="font-size: 11px;">Click to load and watch</p>
                            </div>
                          </div>
                        <% } else { %>
                          <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
                            <div class="text-center text-white">
                              <i class="fab fa-youtube fa-2x text-danger mb-2"></i>
                              <p class="mb-0 small">Invalid URL</p>
                            </div>
                          </div>
                        <% } %>
                      <% } else { %>
                        <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
                          <i class="fab fa-youtube fa-2x text-danger"></i>
                        </div>
                      <% } %>
                      <div class="card-body">
                        <h5 class="card-title"><%= video.title %></h5>
                        <div class="merchant-info">
                          <i class="fas fa-user-tie me-1"></i>
                          <a href="/merchants/<%= video.username %>">
                            <%= video.business_name || video.merchant_name %>
                          </a>
                        </div>
                        <% if (video.description) { %>
                          <p class="card-text small">
                            <% if (video.description.length > 50) { %>
                              <%= video.description.substring(0, 50) %>...
                            <% } else { %>
                              <%= video.description %>
                            <% } %>
                          </p>
                        <% } %>
                        <div class="engagement-stats">
                          <span class="time-info" data-time="<%= video.created_at %>">
                            <i class="fas fa-clock me-1"></i>Loading...
                          </span>
                          <span class="views-info">
                            <i class="fas fa-eye me-1"></i><%= video.clicks_count || 0 %> views
                          </span>
                          <span class="user-info">
                            <i class="fas fa-user me-1"></i>
                            <a href="/user/<%= video.username %>" class="user-link">
                              <%= video.business_name || video.merchant_name %>
                            </a>
                          </span>
                          <% if (video.click_target) { %>
                            <span class="target-info">
                              <i class="fas fa-target me-1"></i>Target <%= video.click_target %>
                            </span>
                          <% } %>
                        </div>
                      </div>
                      <div class="card-footer">
                        <a href="/links/<%= video.id %>/share" class="btn btn-danger w-100">
                          <i class="fas fa-share-alt me-1"></i> Share & Earn
                        </a>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="col-12">
                  <div class="alert alert-info">
                    <i class="fas fa-fire me-2"></i> No popular links available yet.
                  </div>
                </div>
              <% } %>
            </div>
          </div>
        </div>

        <!-- Recently Posted Section for Logged In Users -->
        <div class="row mb-5">
          <div class="col-12">
            <h3 class="text-success mb-3">
              <i class="fas fa-clock me-2"></i>Recently Posted
              <small class="text-muted ms-2">(Latest 3 Links)</small>
            </h3>
            <div class="content-grid" id="recentLinksContainerLoggedIn">
              <% if (lazyLoad) { %>
                <!-- Loading placeholders for lazy loading -->
                <div class="loading-placeholder">
                  <div class="card">
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="placeholder-glow">
                        <span class="placeholder col-7"></span>
                        <span class="placeholder col-4"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="loading-placeholder">
                  <div class="card">
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="placeholder-glow">
                        <span class="placeholder col-7"></span>
                        <span class="placeholder col-4"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="loading-placeholder">
                  <div class="card">
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="placeholder-glow">
                        <span class="placeholder col-7"></span>
                        <span class="placeholder col-4"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                    </div>
                  </div>
                </div>
              <% } else if (typeof recentLinks !== 'undefined' && recentLinks && recentLinks.length > 0) { %>
                <% recentLinks.slice(0, 3).forEach((link, index) => { %>
                  <% 
                    let videoId = '';
                    if (link.type === 'youtube' && link.url) {
                      const youtubeUrl = link.url;
                      const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                      const match = youtubeUrl.match(regex);
                      if (match) {
                        videoId = match[1];
                      }
                    }
                  %>
                  <div class="link-item">
                    <div class="card link-card">
                      <div class="popular-tag">🆕 New</div>
                      <span class="link-type-badge badge <%= 
                        link.type === 'product' ? 'bg-primary' : 
                        link.type === 'youtube' ? 'bg-danger' : 
                        'bg-info' %>">
                        <%= link.type %>
                      </span>
                      <% if (link.type === 'youtube' && link.url) { %>
                        <% if (videoId) { %>
                          <div class="youtube-preview-container" 
                               style="position: relative; width: 100%; height: 180px; background: #000; border-radius: 0;"
                               data-video-id="<%= videoId %>"
                               data-video-title="<%= link.title %>">
                            <div class="youtube-placeholder d-flex flex-column align-items-center justify-content-center h-100 text-white" style="cursor: pointer;">
                              <div class="youtube-play-button-large mb-2">
                                <i class="fab fa-youtube" style="font-size: 2rem; color: #ff0000;"></i>
                              </div>
                              <p class="text-center text-muted px-2 mb-0" style="font-size: 11px;">Click to load and watch</p>
                            </div>
                          </div>
                        <% } else { %>
                          <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
                            <div class="text-center text-white">
                              <i class="fab fa-youtube fa-2x text-danger mb-2"></i>
                              <p class="mb-0 small">Invalid URL</p>
                            </div>
                          </div>
                        <% } %>
                      <% } else if (link.image_url) { %>
                        <img src="<%= link.image_url %>" class="card-img-top" alt="<%= link.title %>" style="height: 180px; object-fit: cover;">
                      <% } else { %>
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                          <i class="<%= 
                            link.type === 'product' ? 'fas fa-shopping-bag' : 
                            link.type === 'youtube' ? 'fab fa-youtube' : 
                            'fas fa-link' %> fa-2x text-muted"></i>
                        </div>
                      <% } %>
                      <div class="card-body">
                        <h5 class="card-title"><%= link.title %></h5>
                        <div class="merchant-info">
                          <i class="fas fa-user-tie me-1"></i>
                          <a href="/merchants/<%= link.username %>">
                            <%= link.business_name || link.merchant_name %>
                          </a>
                        </div>
                        <% if (link.description) { %>
                          <p class="card-text small">
                            <% if (link.description.length > 50) { %>
                              <%= link.description.substring(0, 50) %>...
                            <% } else { %>
                              <%= link.description %>
                            <% } %>
                          </p>
                        <% } %>
                        <div class="engagement-stats">
                          <span class="time-info" data-time="<%= link.created_at %>">
                            <i class="fas fa-clock me-1"></i>Loading...
                          </span>
                          <span class="views-info">
                            <i class="fas fa-eye me-1"></i><%= link.clicks_count || 0 %> views
                          </span>
                          <span class="user-info">
                            <i class="fas fa-user me-1"></i>
                            <a href="/user/<%= link.username %>" class="user-link">
                              <%= link.business_name || link.merchant_name %>
                            </a>
                          </span>
                          <% if (link.click_target) { %>
                            <span class="target-info">
                              <i class="fas fa-target me-1"></i>Target <%= link.click_target %>
                            </span>
                          <% } %>
                        </div>
                      </div>
                      <div class="card-footer">
                        <a href="/links/<%= link.id %>/share" class="btn btn-primary w-100">
                          <i class="fas fa-external-link-alt me-1"></i> Share & Earn
                        </a>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="col-12">
                  <div class="alert alert-info">
                    <i class="fas fa-clock me-2"></i> No recent links available.
                  </div>
                </div>
              <% } %>
            </div>
          </div>
        </div>

        <!-- Search for Logged In Users -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card search-form-responsive">
              <div class="card-body py-3">
                <div class="row g-3 align-items-end link-filter-row">
                  <div class="col-md-6">
                    <label class="form-label">Search Links & Products</label>
                    <input type="text" class="form-control" id="linkSearchLoggedIn" placeholder="Search by title, description, or merchant...">
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="linkTypeFilterLoggedIn">
                      <option value="all">All Content</option>
                      <option value="links">Links Only</option>
                      <option value="products">Products Only</option>
                      <option value="youtube">YouTube Videos</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label d-none d-md-block">&nbsp;</label>
                    <div class="d-flex gap-2 link-filter-buttons">
                      <button type="button" class="btn btn-primary btn-apply-filters" id="linkSearchLoggedInBtn">
                        <i class="fas fa-search me-1"></i><span class="d-none d-md-inline">Search</span><span class="d-md-none">Search</span>
                      </button>
                      <button type="button" class="btn btn-outline-secondary" id="linkClearLoggedInBtn">
                        <i class="fas fa-times"></i><span class="d-none d-md-inline ms-1">Clear</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Links Section for Logged In Users -->
        <div class="row mb-5">
          <div class="col-12">
            <h3 class="text-primary mb-3">
              <i class="fas fa-link me-2"></i>Available Links
            </h3>
            <div class="content-grid" id="linksContainerLoggedIn">
              <% if (lazyLoad) { %>
                <!-- Loading state for lazy loading -->
                <div class="col-12 text-center py-4">
                  <div class="spinner-border text-primary me-2" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <span class="text-muted">Loading available links...</span>
                </div>
              <% } else if (links && links.length > 0) { %>
                <% links.slice(0, 140).forEach((link, index) => { %>
                  <div class="link-item">
                    <div class="card link-card">
                      <% if (index < 3) { %>
                        <div class="popular-tag">Popular</div>
                      <% } %>
                      <% if (link.is_shared_by_user) { %>
                        <div class="shared-tag">Already Shared</div>
                      <% } %>
                      <span class="link-type-badge badge <%= 
                        link.type === 'product' ? 'bg-primary' : 
                        link.type === 'youtube' ? 'bg-danger' : 
                        'bg-info' %>">
                        <%= link.type %>
                      </span>
                  <% if (link.type === 'youtube' && link.url) { %>
                    <% 
                      let videoId = '';
                      const youtubeUrl = link.url;
                      const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                      const match = youtubeUrl.match(regex);
                      if (match) {
                        videoId = match[1];
                      }
                    %>
                    <% if (videoId) { %>
                      <div class="youtube-preview-container" 
                           style="position: relative; width: 100%; height: 180px; background: #000; border-radius: 0;"
                           data-video-id="<%= videoId %>"
                           data-video-title="<%= link.title %>">
                        <div class="youtube-placeholder d-flex flex-column align-items-center justify-content-center h-100 text-white" style="cursor: pointer;">
                          <div class="youtube-play-button-large mb-2">
                            <i class="fab fa-youtube" style="font-size: 2rem; color: #ff0000;"></i>
                          </div>
                          <p class="text-center text-muted px-2 mb-0" style="font-size: 11px;">Click to load and watch</p>
                        </div>
                      </div>
                    <% } else { %>
                      <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
                        <div class="text-center text-white">
                          <i class="fab fa-youtube fa-2x text-danger mb-2"></i>
                          <p class="mb-0 small">Invalid URL</p>
                        </div>
                      </div>
                    <% } %>
                  <% } else if (link.image_url) { %>
                    <img src="<%= link.image_url %>" class="card-img-top" alt="<%= link.title %>" style="height: 180px; object-fit: cover;">
                  <% } else { %>
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <i class="<%= 
                        link.type === 'product' ? 'fas fa-shopping-bag' : 
                        link.type === 'youtube' ? 'fab fa-youtube' : 
                        'fas fa-link' %> fa-2x text-muted"></i>
                    </div>
                  <% } %>
                  <div class="card-body">
                        <h5 class="card-title text-truncate"><%= link.title %></h5>
                        <p class="card-text text-muted small">
                          <i class="fas fa-user-tie me-1"></i> <%= link.business_name || link.merchant_name %>
                          <% if (link.click_target) { %>
                            <small class="ms-2"><i class="fas fa-chart-line me-1"></i> <%= link.clicks_count || 0 %>/<%= link.click_target %></small>
                          <% } %>
                        </p>
                        <p class="card-text small">
                          <% if (link.description && link.description.length > 60) { %>
                            <%= link.description.substring(0, 60) %>...
                          <% } else { %>
                            <%= link.description || 'No description provided.' %>
                          <% } %>
                        </p>
                        <% if (link.price) { %>
                          <p class="card-text text-success small fw-bold">$<%= parseFloat(link.price).toFixed(2) %></p>
                        <% } %>
                      </div>
                      <div class="card-footer bg-white border-top-0 mt-auto">
                        <% if (link.is_shared_by_user) { %>
                          <a href="/links/<%= link.id %>/share" class="btn btn-success btn-sm w-100">
                            <i class="fas fa-check me-1"></i> Reshare & Earn
                          </a>
                        <% } else { %>
                          <a href="/links/<%= link.id %>/share" class="btn btn-primary btn-sm w-100">
                            <i class="fas fa-share-alt me-1"></i> Share & Earn
                          </a>
                        <% } %>
                      </div>
                </div>
              </div>
            <% }); %>
          <% } else { %>
            <div class="col-12">
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i> No links available at the moment. Please check back later.
              </div>
            </div>
          <% } %>
            </div>
          </div>
        </div>

        <!-- Products Section for Logged In Users -->
        <div class="row mb-5">
          <div class="col-12">
            <h3 class="text-success mb-3">
              <i class="fas fa-shopping-bag me-2"></i>Available Products
            </h3>
            <div class="content-grid" id="productsContainerLoggedIn">
              <% if (lazyLoad) { %>
                <!-- Loading placeholders for lazy loading -->
                <div class="loading-placeholder">
                  <div class="card">
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="placeholder-glow">
                        <span class="placeholder col-7"></span>
                        <span class="placeholder col-4"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="loading-placeholder">
                  <div class="card">
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="placeholder-glow">
                        <span class="placeholder col-7"></span>
                        <span class="placeholder col-4"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="loading-placeholder">
                  <div class="card">
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                      <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="placeholder-glow">
                        <span class="placeholder col-7"></span>
                        <span class="placeholder col-4"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                    </div>
                  </div>
                </div>
              <% } else if (products && products.length > 0) { %>
                <% products.slice(0, 14).forEach((product, index) => { %>
                  <div class="product-item">
                    <div class="card product-card">
                      <% if (index < 2) { %>
                        <div class="popular-tag">Popular</div>
                      <% } %>
                      <% if (product.image_url) { %>
                        <img src="<%= product.image_url %>" class="card-img-top" alt="<%= product.name %>" style="height: 180px; object-fit: cover;">
                      <% } else { %>
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                          <i class="fas fa-shopping-bag fa-2x text-muted"></i>
                        </div>
                      <% } %>
                      <div class="card-body">
                        <h5 class="card-title text-truncate"><%= product.name %></h5>
                        <p class="card-text text-muted small">
                          <i class="fas fa-user-tie me-1"></i> <%= product.merchant_name %>
                        </p>
                        <p class="card-text small">
                          <% if (product.description && product.description.length > 60) { %>
                            <%= product.description.substring(0, 60) %>...
                          <% } else { %>
                            <%= product.description || 'No description available.' %>
                          <% } %>
                        </p>
                        <h6 class="mt-auto mb-0 text-success">$<%= parseFloat(product.price).toFixed(2) %></h6>
                      </div>
                      <div class="card-footer bg-white border-top-0 mt-auto">
                        <a href="/products/<%= product.id %>" class="btn btn-success btn-sm w-100">
                          <i class="fas fa-shopping-cart me-1"></i> View Product
                        </a>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="col-12">
                  <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> No products available at the moment.
                  </div>
                </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    <% } %>
  </div>

  <%- include('partials/footer') %>
<script>
  function alerting() {
    alert('This feature is not implemented yet.');
  }
</script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
  
  <!-- YouTube API Script -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // Store original data for filtering
    let originalProducts = [];
    let originalLinks = [];
    let productCategories = new Set();

    // Search functionality
    function initSearchFunctionality() {
      // Search elements for non-logged-in users
      const searchInput = document.getElementById('unifiedSearch');
      const searchBtn = document.getElementById('searchBtn');
      const clearBtn = document.getElementById('clearBtn');
      const contentTypeFilter = document.getElementById('contentTypeFilter');

      // Search elements for logged-in users
      const loggedInSearchInput = document.getElementById('linkSearchLoggedIn');
      const loggedInSearchBtn = document.getElementById('linkSearchLoggedInBtn');
      const loggedInClearBtn = document.getElementById('linkClearLoggedInBtn');
      const loggedInContentTypeFilter = document.getElementById('linkTypeFilterLoggedIn');

      // Determine which set of elements to use
      const activeSearchInput = searchInput || loggedInSearchInput;
      const activeSearchBtn = searchBtn || loggedInSearchBtn;
      const activeClearBtn = clearBtn || loggedInClearBtn;
      const activeContentTypeFilter = contentTypeFilter || loggedInContentTypeFilter;

      if (!activeSearchInput || !activeSearchBtn || !activeClearBtn || !activeContentTypeFilter) {
        console.log('Search elements not found');
        console.log('Elements found:', {
          searchInput: !!activeSearchInput,
          searchBtn: !!activeSearchBtn,
          clearBtn: !!activeClearBtn,
          contentTypeFilter: !!activeContentTypeFilter
        });
        return;
      }

      console.log('Search functionality initialized for:', searchInput ? 'non-logged-in users' : 'logged-in users');

      // Search function
      function performSearch() {
        const query = activeSearchInput.value.trim().toLowerCase();
        const contentType = activeContentTypeFilter.value;

        console.log('Performing search:', query, 'Type:', contentType);

        // Get all content containers
        const containers = {
          mostViewed: document.getElementById('mostViewedLinksContainer') || 
                     document.getElementById('mostViewedLinksContainerLoggedIn'),
          recent: document.getElementById('recentLinksContainer') || 
                 document.getElementById('recentLinksContainerLoggedIn'),
          links: document.getElementById('linksContainer') || 
                document.getElementById('linksContainerLoggedIn'),
          products: document.getElementById('productsContainer') || 
                   document.getElementById('productsContainerLoggedIn')
        };

        console.log('Found containers:', containers);

        // Handle section visibility based on content type
        handleSectionVisibility(contentType);

        if (query === '') {
          // Show all items if no search query
          showAllItems(containers);
          return;
        }

        // Perform filtering
        let totalVisible = 0;
        
        if (contentType === 'all' || contentType === 'links') {
          totalVisible += filterContainerItems(containers.mostViewed, query);
          totalVisible += filterContainerItems(containers.recent, query);
          totalVisible += filterContainerItems(containers.links, query);
        } else {
          // Hide all link items if not searching links
          hideAllItems(containers.mostViewed);
          hideAllItems(containers.recent);
          hideAllItems(containers.links);
        }

        if (contentType === 'all' || contentType === 'products') {
          totalVisible += filterContainerItems(containers.products, query);
        } else {
          // Hide all product items if not searching products
          hideAllItems(containers.products);
        }

        console.log('Total visible items:', totalVisible);
      }

      function handleSectionVisibility(contentType) {
        // Get all section headers and containers
        const sections = {
          mostViewed: document.querySelector('.col-12:has(#mostViewedLinksContainer), .col-12:has(#mostViewedLinksContainerLoggedIn)'),
          recent: document.querySelector('.col-12:has(#recentLinksContainer), .col-12:has(#recentLinksContainerLoggedIn)'),
          links: document.querySelector('.col-12:has(#linksContainer), .col-12:has(#linksContainerLoggedIn)'),
          products: document.querySelector('.col-12:has(#productsContainer), .col-12:has(#productsContainerLoggedIn)')
        };

        // Fallback method to find sections
        if (!sections.mostViewed) {
          const container = document.getElementById('mostViewedLinksContainer') || document.getElementById('mostViewedLinksContainerLoggedIn');
          sections.mostViewed = container ? container.closest('.col-12, .mb-5') : null;
        }
        if (!sections.recent) {
          const container = document.getElementById('recentLinksContainer') || document.getElementById('recentLinksContainerLoggedIn');
          sections.recent = container ? container.closest('.col-12, .mb-5') : null;
        }
        if (!sections.links) {
          const container = document.getElementById('linksContainer') || document.getElementById('linksContainerLoggedIn');
          sections.links = container ? container.closest('.col-12, .mb-5') : null;
        }
        if (!sections.products) {
          const container = document.getElementById('productsContainer') || document.getElementById('productsContainerLoggedIn');
          sections.products = container ? container.closest('.col-12, .mb-5') : null;
        }

        console.log('Section visibility for content type:', contentType, sections);

        // Show/hide sections based on content type
        Object.keys(sections).forEach(key => {
          const section = sections[key];
          if (section) {
            if (contentType === 'all') {
              section.style.display = 'block';
            } else if (contentType === 'links' && key !== 'products') {
              section.style.display = 'block';
            } else if (contentType === 'products' && key === 'products') {
              section.style.display = 'block';
            } else {
              section.style.display = 'none';
            }
          }
        });
      }

      function filterContainerItems(container, query) {
        if (!container) {
          console.log('Container not found');
          return 0;
        }

        const items = container.querySelectorAll('.link-item, .product-item');
        let visibleCount = 0;

        console.log(`Filtering ${items.length} items in container`);

        items.forEach((item, index) => {
          const title = item.querySelector('.card-title')?.textContent.toLowerCase() || '';
          const description = item.querySelector('.card-text')?.textContent.toLowerCase() || '';
          const merchantInfo = item.querySelector('.merchant-info')?.textContent.toLowerCase() || '';
          const userInfo = item.querySelector('.user-info')?.textContent.toLowerCase() || '';
          
          const matches = title.includes(query) || 
                         description.includes(query) || 
                         merchantInfo.includes(query) ||
                         userInfo.includes(query);

          if (matches) {
            item.style.display = 'block';
            item.style.visibility = 'visible';
            visibleCount++;
            console.log(`Item ${index} matches: "${title.substring(0, 30)}..."`);
          } else {
            item.style.display = 'none';
            item.style.visibility = 'hidden';
          }
        });

        // Update no results message
        updateNoResultsMessage(container, visibleCount, query);
        
        console.log(`Container has ${visibleCount} visible items`);
        return visibleCount;
      }

      function hideAllItems(container) {
        if (!container) return;
        
        const items = container.querySelectorAll('.link-item, .product-item');
        items.forEach(item => {
          item.style.display = 'none';
          item.style.visibility = 'hidden';
        });
        
        // Remove no results messages
        const noResultsMsg = container.querySelector('.no-results-message');
        if (noResultsMsg) {
          noResultsMsg.remove();
        }
      }

      function showAllItems(containers) {
        console.log('Showing all items');
        
        Object.values(containers).forEach(container => {
          if (container) {
            const items = container.querySelectorAll('.link-item, .product-item');
            items.forEach(item => {
              item.style.display = 'block';
              item.style.visibility = 'visible';
            });
            
            // Remove no results messages
            const noResultsMsg = container.querySelector('.no-results-message');
            if (noResultsMsg) {
              noResultsMsg.remove();
            }
          }
        });

        // Show all sections
        handleSectionVisibility('all');
      }

      function updateNoResultsMessage(container, visibleCount, query) {
        // Remove existing no results message
        const existingMsg = container.querySelector('.no-results-message');
        if (existingMsg) {
          existingMsg.remove();
        }

        // Add no results message if needed
        if (visibleCount === 0 && query) {
          const noResultsDiv = document.createElement('div');
          noResultsDiv.className = 'link-item no-results-message';
          noResultsDiv.style.gridColumn = '1 / -1'; // Span full width in grid
          noResultsDiv.innerHTML = `
            <div class="alert alert-info">
              <i class="fas fa-search me-2"></i>No results found for "${query}"
            </div>
          `;
          container.appendChild(noResultsDiv);
        }
      }

      function clearSearch() {
        console.log('Clearing search');
        activeSearchInput.value = '';
        activeContentTypeFilter.value = 'all';
        
        const containers = {
          mostViewed: document.getElementById('mostViewedLinksContainer') || 
                     document.getElementById('mostViewedLinksContainerLoggedIn'),
          recent: document.getElementById('recentLinksContainer') || 
                 document.getElementById('recentLinksContainerLoggedIn'),
          links: document.getElementById('linksContainer') || 
                document.getElementById('linksContainerLoggedIn'),
          products: document.getElementById('productsContainer') || 
                   document.getElementById('productsContainerLoggedIn')
        };
        
        showAllItems(containers);
      }

      // Event listeners
      activeSearchBtn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Search button clicked');
        performSearch();
      });

      activeClearBtn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Clear button clicked');
        clearSearch();
      });

      activeSearchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          console.log('Enter key pressed');
          performSearch();
        }
      });

      // Real-time search (debounced)
      let searchTimeout;
      activeSearchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          console.log('Input changed:', this.value);
          performSearch();
        }, 300);
      });

      activeContentTypeFilter.addEventListener('change', function() {
        console.log('Content type changed:', this.value);
        performSearch();
      });
    }

    // Initialize search when DOM is loaded
    document.addEventListener('DOMContentLoaded', initSearchFunctionality);

    // Update time badges
    function updateTimeBadges() {
      document.querySelectorAll('.time-info[data-time]').forEach(timeElement => {
        const timeStr = timeElement.getAttribute('data-time');
        if (timeStr) {
          fetch(`/api/time-ago/${encodeURIComponent(timeStr)}`)
            .then(response => response.json())
            .then(data => {
              timeElement.innerHTML = `<i class="fas fa-clock me-1"></i>${data.timeAgo}`;
            })
            .catch(() => {
              timeElement.innerHTML = '<i class="fas fa-clock me-1"></i>Recently';
            });
        }
      });
    }

    // Load more links functionality
    let linksPage = 1;
    let productsPage = 1;
    let isLoadingLinks = false;
    let isLoadingProducts = false;
    
    // Infinite scroll for logged-in users
    function initInfiniteScroll() {
      window.addEventListener('scroll', () => {
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 1000) {
          if (!isLoadingLinks && document.getElementById('linksContainerLoggedIn')) {
            loadMoreLinksInfinite();
          }
        }
      });
    }
    
    function loadMoreLinksInfinite() {
      if (isLoadingLinks) return;
      isLoadingLinks = true;
      
      fetch(`/api/links/load-more?page=${linksPage + 1}&limit=14`)
        .then(response => response.json())
        .then(data => {
          if (data.success && data.links.length > 0) {
            data.links.forEach(link => {
              const linkElement = createLinkElementLoggedIn(link);
              document.getElementById('linksContainerLoggedIn').appendChild(linkElement);
            });
            linksPage++;
          }
          isLoadingLinks = false;
        })
        .catch(() => {
          isLoadingLinks = false;
        });
    }
    
    document.getElementById('loadMoreLinks')?.addEventListener('click', function() {
      this.disabled = true;
      this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Loading...';
      
      fetch(`/api/links/load-more?page=${linksPage + 1}&limit=14`)
        .then(response => response.json())
        .then(data => {
          if (data.success && data.links.length > 0) {
            data.links.forEach(link => {
              const linkElement = createLinkElement(link);
              document.getElementById('linksContainer').appendChild(linkElement);
            });
            linksPage++;
            
            // Update time badges for new items
            setTimeout(updateTimeBadges, 100);
            
            // Hide button if no more items
            if (data.links.length < 14) {
              this.style.display = 'none';
            } else {
              this.disabled = false;
              this.innerHTML = '<i class="fas fa-plus me-1"></i> Load More Links';
            }
          } else {
            this.style.display = 'none';
          }
        })
        .catch(() => {
          this.disabled = false;
          this.innerHTML = '<i class="fas fa-plus me-1"></i> Load More Links';
        });
    });
    
    // Load more products functionality
    document.getElementById('loadMoreProducts')?.addEventListener('click', function() {
      this.disabled = true;
      this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Loading...';
      
      fetch(`/api/products/load-more?page=${productsPage + 1}&limit=14`)
        .then(response => response.json())
        .then(data => {
          if (data.success && data.products.length > 0) {
            data.products.forEach(product => {
              const productElement = createProductElement(product);
              document.getElementById('productsContainer').appendChild(productElement);
            });
            productsPage++;
            
            // Update time badges for new items
            setTimeout(updateTimeBadges, 100);
            
            // Hide button if no more items
            if (data.products.length < 14) {
              this.style.display = 'none';
            } else {
              this.disabled = false;
              this.innerHTML = '<i class="fas fa-plus me-1"></i> Load More Products';
            }
          } else {
            this.style.display = 'none';
          }
        })
        .catch(() => {
          this.disabled = false;
          this.innerHTML = '<i class="fas fa-plus me-1"></i> Load More Products';
        });
    });
    
    // Create link element function
    function createLinkElement(link) {
      const div = document.createElement('div');
      div.className = 'link-item';
      
      let imageHtml = '';
      if (link.type === 'youtube' && link.url) {
        const videoId = extractYouTubeId(link.url);
        if (videoId) {
          imageHtml = `
            <div class="youtube-preview" onclick="playYouTubeVideo('${videoId}', this)">
              <img src="https://img.youtube.com/vi/${videoId}/hqdefault.jpg" 
                   class="card-img-top" 
                   alt="${link.title}">
              <div class="youtube-play-button">
                <i class="fab fa-youtube"></i>
              </div>
            </div>`;
        } else {
          imageHtml = `
            <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
              <div class="text-center text-white">
                <i class="fab fa-youtube fa-2x text-danger mb-2"></i>
                <p class="mb-0 small">Invalid URL</p>
              </div>
            </div>`;
        }
      } else if (link.image_url) {
        imageHtml = `<img src="${link.image_url}" class="card-img-top" alt="${link.title}" style="height: 180px; object-fit: cover;">`;
      } else {
        const iconClass = link.type === 'product' ? 'fas fa-shopping-bag' : 
                         link.type === 'youtube' ? 'fab fa-youtube' : 'fas fa-link';
        imageHtml = `
          <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
            <i class="${iconClass} fa-2x text-muted"></i>
          </div>`;
      }
      
      div.innerHTML = `
        <div class="card link-card">
          <div class="popular-tag" style="display: none;">Popular</div>
          <span class="link-type-badge badge ${
            link.type === 'product' ? 'bg-primary' : 
            link.type === 'youtube' ? 'bg-danger' : 
            'bg-info'
          }">
            ${link.type}
          </span>
          ${imageHtml}
          <div class="card-body">
            <h5 class="card-title">${link.title}</h5>
            <div class="merchant-info">
              <i class="fas fa-user-tie me-1"></i>
              <a href="/merchant/${link.username}">
                ${link.business_name || link.merchant_name}
              </a>
            </div>
            ${link.description ? `
              <p class="card-text small">
                ${link.description.length > 50 ? 
                  link.description.substring(0, 50) + '...' : 
                  link.description}
              </p>
            ` : ''}
            <div class="engagement-stats">
              <span class="time-info" data-time="${link.created_at}">
                <i class="fas fa-clock me-1"></i>Loading...
              </span>
              <span class="views-info">
                <i class="fas fa-eye me-1"></i>${link.clicks_count || 0} views
              </span>
              <span class="user-info">
                <i class="fas fa-user me-1"></i>
                <a href="/user/${link.username}" class="user-link">
                  ${link.business_name || link.merchant_name}
                </a>
              </span>
              ${link.click_target ? `
                <span class="target-info">
                  <i class="fas fa-target me-1"></i>Target ${link.click_target}
                </span>
              ` : ''}
            </div>
          </div>
          <div class="card-footer">
            <a href="/links/${link.id}/share" class="btn btn-primary w-100">
              <i class="fas fa-external-link-alt me-1"></i> Share & Earn
            </a>
          </div>
        </div>`;
      
      return div;
    }
    
    // Create link element function for logged-in users (with share status)
    function createLinkElementLoggedIn(link) {
      const div = document.createElement('div');
      div.className = 'link-item';
      
      let imageHtml = '';
      if (link.type === 'youtube' && link.url) {
        const videoId = extractYouTubeId(link.url);
        if (videoId) {
          imageHtml = `
            <div class="youtube-preview-container" 
                 style="position: relative; width: 100%; height: 180px; background: #000; border-radius: 0;"
                 data-video-id="${videoId}"
                 data-video-title="${link.title}">
              <div class="youtube-placeholder d-flex flex-column align-items-center justify-content-center h-100 text-white" style="cursor: pointer;">
                <div class="youtube-play-button-large mb-2">
                  <i class="fab fa-youtube" style="font-size: 2rem; color: #ff0000;"></i>
                </div>
                <p class="text-center text-muted px-2 mb-0" style="font-size: 11px;">Click to load and watch</p>
              </div>
            </div>`;
        } else {
          imageHtml = `
            <div class="card-img-top bg-dark d-flex align-items-center justify-content-center" style="height: 180px;">
              <div class="text-center text-white">
                <i class="fab fa-youtube fa-2x text-danger mb-2"></i>
                <p class="mb-0 small">Invalid URL</p>
              </div>
            </div>`;
        }
      } else if (link.image_url) {
        imageHtml = `<img src="${link.image_url}" class="card-img-top" alt="${link.title}" style="height: 180px; object-fit: cover;">`;
      } else {
        const iconClass = link.type === 'product' ? 'fas fa-shopping-bag' : 
                         link.type === 'youtube' ? 'fab fa-youtube' : 'fas fa-link';
        imageHtml = `
          <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
            <i class="${iconClass} fa-2x text-muted"></i>
          </div>`;
      }
      
      const sharedTagHtml = link.is_shared_by_user ? '<div class="shared-tag">Already Shared</div>' : '';
      const buttonHtml = link.is_shared_by_user ? 
        `<a href="/links/${link.id}/share" class="btn btn-success btn-sm w-100">
           <i class="fas fa-check me-1"></i> Reshare & Earn
         </a>` :
        `<a href="/links/${link.id}/share" class="btn btn-primary btn-sm w-100">
           <i class="fas fa-share-alt me-1"></i> Share & Earn
         </a>`;
      
      div.innerHTML = `
        <div class="card link-card">
          <div class="popular-tag" style="display: none;">Popular</div>
          ${sharedTagHtml}
          <span class="link-type-badge badge ${
            link.type === 'product' ? 'bg-primary' : 
            link.type === 'youtube' ? 'bg-danger' : 
            'bg-info'
          }">
            ${link.type}
          </span>
          ${imageHtml}
          <div class="card-body">
            <h5 class="card-title text-truncate">${link.title}</h5>
            <p class="card-text text-muted small">
              <i class="fas fa-user-tie me-1"></i> ${link.business_name || link.merchant_name}
              ${link.click_target ? `
                <small class="ms-2"><i class="fas fa-chart-line me-1"></i> ${link.clicks_count || 0}/${link.click_target}</small>
              ` : ''}
            </p>
            <p class="card-text small">
              ${link.description && link.description.length > 60 ? 
                link.description.substring(0, 60) + '...' : 
                link.description || 'No description provided.'}
            </p>
            ${link.price ? `<p class="card-text text-success small fw-bold">$${parseFloat(link.price).toFixed(2)}</p>` : ''}
          </div>
          <div class="card-footer bg-white border-top-0 mt-auto">
            ${buttonHtml}
          </div>
        </div>`;
      
      return div;
    }
    
    // Create product element function
    function createProductElement(product) {
      const div = document.createElement('div');
      div.className = 'product-item';
      
      const imageHtml = product.image_url ? 
        `<img src="${product.image_url}" class="card-img-top" alt="${product.name}" style="height: 180px; object-fit: cover;">` :
        `<div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
           <i class="fas fa-shopping-bag fa-2x text-muted"></i>
         </div>`;
      
      div.innerHTML = `
        <div class="card product-card">
          <div class="popular-tag" style="display: none;">Hot</div>
          ${imageHtml}
          <div class="card-body">
            <h5 class="card-title">${product.name}</h5>
            <div class="merchant-info">
              <i class="fas fa-user-tie me-1"></i>
              <a href="/merchant/${product.username}">
                ${product.merchant_name}
              </a>
            </div>
            ${product.description ? `
              <p class="card-text small">
                ${product.description.length > 50 ? 
                  product.description.substring(0, 50) + '...' : 
                  product.description}
              </p>
            ` : ''}
            <div class="price-display">$${parseFloat(product.price).toFixed(2)}</div>
            <div class="engagement-stats">
              <span class="time-info" data-time="${product.created_at}">
                <i class="fas fa-clock me-1"></i>Loading...
              </span>
              <span class="user-info">
                <i class="fas fa-user me-1"></i>
                <a href="/user/${product.username}" class="user-link">
                  ${product.merchant_name}
                </a>
              </span>
            </div>
          </div>
          <div class="card-footer">
            <a href="/products/${product.id}" class="btn btn-success w-100">
              <i class="fas fa-shopping-cart me-1"></i> View Product
            </a>
          </div>
        </div>`;
      
      return div;
    }
    
    // Extract YouTube video ID
    function extractYouTubeId(url) {
      const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }
    
    // Lazy loading function for logged-in users
    function loadInitialContent() {
      fetch('/api/content/initial')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Load popular links
            const popularContainer = document.getElementById('mostViewedLinksContainerLoggedIn');
            if (popularContainer && data.data.popularLinks) {
              popularContainer.innerHTML = '';
              data.data.popularLinks.forEach(link => {
                const linkElement = createLinkElementLoggedIn(link);
                popularContainer.appendChild(linkElement);
              });
            }
            
            // Load recent links  
            const recentContainer = document.getElementById('recentLinksContainerLoggedIn');
            if (recentContainer && data.data.recentLinks) {
              recentContainer.innerHTML = '';
              data.data.recentLinks.forEach(link => {
                const linkElement = createLinkElementLoggedIn(link);
                recentContainer.appendChild(linkElement);
              });
            }
            
            // Load products
            const productsContainer = document.getElementById('productsContainerLoggedIn');
            if (productsContainer && data.data.products) {
              productsContainer.innerHTML = '';
              data.data.products.forEach(product => {
                const productElement = createProductElement(product);
                productsContainer.appendChild(productElement);
              });
            }
            
            // Clear loading state for links section
            const linksContainer = document.getElementById('linksContainerLoggedIn');
            if (linksContainer) {
              linksContainer.innerHTML = '<div class="col-12 text-center text-muted py-4">Scroll down to load links...</div>';
            }
          }
        })
        .catch(error => {
          console.error('Error loading initial content:', error);
          // Show error message but don't break the page
          const containers = ['mostViewedLinksContainerLoggedIn', 'recentLinksContainerLoggedIn', 'linksContainerLoggedIn'];
          containers.forEach(containerId => {
            const container = document.getElementById(containerId);
            if (container) {
              container.innerHTML = '<div class="col-12 text-center text-danger py-4"><i class="fas fa-exclamation-triangle me-2"></i>Failed to load content. Please refresh the page.</div>';
            }
          });
        });
    }
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Lazy loading for logged-in users
      const lazyLoad = <%- lazyLoad ? 'true' : 'false' %>;
      if (lazyLoad) {
        loadInitialContent();
      }
      
      // Initialize infinite scroll for logged-in users
      if (document.getElementById('linksContainerLoggedIn')) {
        initInfiniteScroll();
      }
      
      // Initialize time badges on page load
      updateTimeBadges();
      
      // Initialize YouTube lazy loading and auto-load detection
      initYouTubeLazyLoading();
      initYouTubeAutoLoad();
    });
    
    // YouTube video loading functionality - copied from share.ejs with multi-video support
    function loadYouTubeVideo(container, videoId, title) {
      // First, pause any currently playing videos
      pauseAllOtherVideos(container);
      
      // Show loading spinner
      container.innerHTML = `
        <div class="d-flex align-items-center justify-content-center h-100">
          <div class="spinner-border text-danger" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading video...</span>
          </div>
        </div>
      `;
      
      // Create iframe
      const iframe = document.createElement('iframe');
      iframe.width = '100%';
      iframe.height = '180';
      iframe.src = `https://www.youtube.com/embed/${videoId}?enablejsapi=1&modestbranding=1&rel=0&showinfo=0&autoplay=1`;
      iframe.title = title;
      iframe.frameBorder = '0';
      iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
      iframe.allowFullscreen = true;
      
      iframe.onload = function() {
        console.log('YouTube video loaded successfully');
      };
      
      iframe.onerror = function() {
        console.error('Error loading YouTube video');
        container.innerHTML = `
          <div class="d-flex flex-column align-items-center justify-content-center h-100 text-white bg-dark">
            <i class="fab fa-youtube fa-3x text-danger mb-3"></i>
            <p class="mb-2">Unable to load video</p>
            <button class="btn btn-outline-light btn-sm mt-2" onclick="window.open('https://youtube.com/watch?v=${videoId}', '_blank')">
              <i class="fas fa-external-link-alt me-1"></i>
              Watch on YouTube
            </button>
          </div>
        `;
      };
      
      container.innerHTML = '';
      container.appendChild(iframe);
    }

    // Function to pause all other playing videos
    function pauseAllOtherVideos(currentContainer) {
      const allContainers = document.querySelectorAll('.youtube-preview-container');
      allContainers.forEach(container => {
        if (container !== currentContainer) {
          const iframe = container.querySelector('iframe');
          if (iframe) {
            // Try to pause the video using YouTube iframe API
            try {
              iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
            } catch (error) {
              console.log('Could not pause video:', error);
            }
          }
        }
      });
    }

    // Initialize YouTube video loading
    document.addEventListener('DOMContentLoaded', function() {
      const youtubeContainers = document.querySelectorAll('.youtube-preview-container');
      youtubeContainers.forEach(container => {
        container.addEventListener('click', function() {
          const videoId = this.dataset.videoId;
          const videoTitle = this.dataset.videoTitle;
          
          if (videoId) {
            loadYouTubeVideo(this, videoId, videoTitle);
          }
        });
      });
    });
  </script>

  <!-- PWA Install Button and Status -->
  <button id="installBtn" class="btn-install-pwa">
    <i class="fas fa-download me-2"></i>
    Install App
  </button>
  
  <div id="pwaStatus" class="pwa-status">
    <i class="fas fa-check-circle me-1"></i>
    App ready to install!
  </div>

  <!-- PWA JavaScript -->
  <script>
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    const pwaStatus = document.getElementById('pwaStatus');

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then((registration) => {
            console.log('✅ Service Worker registered successfully:', registration.scope);
            
            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // Show update available notification
                  showPWANotification('New version available! Refresh to update.', 'info');
                }
              });
            });
          })
          .catch((error) => {
            console.log('❌ Service Worker registration failed:', error);
          });
      });
    }

    // PWA Install Prompt
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('💡 PWA install prompt triggered');
      e.preventDefault();
      deferredPrompt = e;
      
      // Show install button
      installBtn.classList.add('show');
      
      // Show status notification
      showPWANotification('Ready to install!', 'success');
    });

    // Install button click handler
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) {
        return;
      }

      // Show install prompt
      deferredPrompt.prompt();
      
      // Wait for user response
      const { outcome } = await deferredPrompt.userChoice;
      
      if (outcome === 'accepted') {
        console.log('✅ User accepted PWA install');
        showPWANotification('Installing BenixSpace...', 'success');
      } else {
        console.log('❌ User dismissed PWA install');
        showPWANotification('Install cancelled', 'info');
      }
      
      // Hide install button
      installBtn.classList.remove('show');
      deferredPrompt = null;
    });

    // PWA installed event
    window.addEventListener('appinstalled', () => {
      console.log('✅ PWA installed successfully');
      installBtn.classList.remove('show');
      showPWANotification('BenixSpace installed successfully!', 'success');
      
      // Track installation
      if (typeof gtag !== 'undefined') {
        gtag('event', 'pwa_install', {
          'event_category': 'PWA',
          'event_label': 'App Installed'
        });
      }
    });

    // Check if already installed
    window.addEventListener('load', () => {
      if (window.matchMedia('(display-mode: standalone)').matches || 
          window.navigator.standalone === true) {
        console.log('🎉 Running as PWA');
        document.body.classList.add('pwa-mode');
      }
    });

    // PWA Notification System
    function showPWANotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `pwa-notification pwa-${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} me-2"></i>
          ${message}
        </div>
      `;
      
      // Add styles
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'rgba(40, 167, 69, 0.95)' : type === 'error' ? 'rgba(220, 53, 69, 0.95)' : 'rgba(23, 162, 184, 0.95)'};
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 600;
        z-index: 1002;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
        max-width: 300px;
      `;
      
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    }

    // Add slide animation styles
    if (!document.getElementById('pwa-animations')) {
      const style = document.createElement('style');
      style.id = 'pwa-animations';
      style.textContent = `
        @keyframes slideInRight {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
          from { opacity: 1; }
          to { opacity: 0; }
        }
        .pwa-mode {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
        }
      `;
      document.head.appendChild(style);
    }

    // Enhanced PWA features
    window.addEventListener('online', () => {
      showPWANotification('Back online!', 'success');
    });

    window.addEventListener('offline', () => {
      showPWANotification('You\'re offline. Some features may be limited.', 'info');
    });

    // Handle external links in PWA mode
    if (window.matchMedia('(display-mode: standalone)').matches) {
      document.addEventListener('click', (e) => {
        if (e.target.tagName === 'A' && e.target.href && 
            !e.target.href.startsWith(window.location.origin)) {
          e.preventDefault();
          window.open(e.target.href, '_blank');
        }
      });
    }
    
    // Blog Slider Functionality
    let currentBlogSlide = 0;
    let blogSlides = [];
    let blogSlideInterval;
    
    function initBlogSlider() {
      blogSlides = document.querySelectorAll('#blogSlider .blog-slide');
      console.log('Non-logged-in blog slider initialized with', blogSlides.length, 'slides');
      
      if (blogSlides.length === 0) {
        console.log('No blog slides found for non-logged-in users');
        return;
      }

      // Log each slide for debugging
      blogSlides.forEach((slide, index) => {
        console.log(`Slide ${index}:`, slide);
      });
      
      // Initialize dots
      const dotsContainer = document.getElementById('blogSliderDots');
      if (dotsContainer) {
        dotsContainer.innerHTML = '';
        
        blogSlides.forEach((_, index) => {
          const dot = document.createElement('div');
          dot.className = 'blog-dot';
          dot.onclick = () => goToBlogSlide(index);
          dotsContainer.appendChild(dot);
        });
      }
      
      // Show first slide
      console.log('Calling showBlogSlide(0) to show first slide');
      showBlogSlide(0);
      
      // Start auto-slide only if there's more than one slide
      if (blogSlides.length > 1) {
        console.log('Starting auto-slide for', blogSlides.length, 'slides');
        startBlogAutoSlide();
      } else {
        console.log('Only', blogSlides.length, 'slide found, auto-slide disabled');
        // Force auto-slide for debugging even with 1 slide
        console.log('Force starting auto-slide for debugging...');
        startBlogAutoSlide();
      }
      
      // Pause on hover
      const sliderContainer = document.querySelector('#blogSlider').closest('.blog-slider-container');
      if (sliderContainer) {
        sliderContainer.addEventListener('mouseenter', stopBlogAutoSlide);
        sliderContainer.addEventListener('mouseleave', startBlogAutoSlide);
      }
    }
    
    function showBlogSlide(index) {
      if (blogSlides.length === 0) {
        console.log('No blog slides available');
        return;
      }
      
      console.log('Showing blog slide', index, 'of', blogSlides.length);
      
      // Hide all slides
      blogSlides.forEach((slide, i) => {
        slide.classList.remove('active');
        console.log('Hiding slide', i);
      });
      
      // Update dots
      const dots = document.querySelectorAll('#blogSliderDots .blog-dot');
      dots.forEach(dot => dot.classList.remove('active'));
      
      // Show current slide
      currentBlogSlide = index;
      if (blogSlides[currentBlogSlide]) {
        blogSlides[currentBlogSlide].classList.add('active');
        console.log('Showing slide', currentBlogSlide);
      }
      if (dots[currentBlogSlide]) {
        dots[currentBlogSlide].classList.add('active');
      }
    }
    
    function slideBlog(direction) {
      console.log('slideBlog called with direction:', direction, 'current slide:', currentBlogSlide);
      
      if (blogSlides.length === 0) {
        console.log('No slides available, returning');
        return;
      }
      
      currentBlogSlide += direction;
      console.log('New slide index before bounds check:', currentBlogSlide);
      
      if (currentBlogSlide >= blogSlides.length) {
        currentBlogSlide = 0;
        console.log('Wrapped to first slide:', currentBlogSlide);
      } else if (currentBlogSlide < 0) {
        currentBlogSlide = blogSlides.length - 1;
        console.log('Wrapped to last slide:', currentBlogSlide);
      }
      
      console.log('Final slide index:', currentBlogSlide);
      showBlogSlide(currentBlogSlide);
    }
    
    function goToBlogSlide(index) {
      if (index >= 0 && index < blogSlides.length) {
        showBlogSlide(index);
      }
    }
    
    function startBlogAutoSlide() {
      console.log('startBlogAutoSlide called with', blogSlides.length, 'slides');
      stopBlogAutoSlide();
      
      // Force start even with 1 slide for debugging
      if (blogSlides.length >= 1) {
        console.log('Setting up auto-slide interval...');
        blogSlideInterval = setInterval(() => {
          console.log('Auto-slide interval triggered, calling slideBlog(1)');
          slideBlog(1);
        }, 3000); // Change slide every 3 seconds for faster debugging
        console.log('Auto-slide interval started with ID:', blogSlideInterval);
      } else {
        console.log('No slides available for auto-slide');
      }
    }
    
    function stopBlogAutoSlide() {
      if (blogSlideInterval) {
        clearInterval(blogSlideInterval);
        blogSlideInterval = null;
      }
    }
    
    // Share Post Function
    function sharePost(postId, title, slug) {
      const userLoggedIn = <%- user ? 'true' : 'false' %>;
      if (!userLoggedIn) {
        window.location.href = '/auth';
        return;
      }
      
      const userId = <%- user ? user.id : 'null' %>;
      
      // Create or get existing share
      fetch(`/blog/${postId}/share`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          userId: userId
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Show share URL or copy to clipboard
          const shareUrl = `${window.location.origin}/blog/shared/${data.shareId}`;
          
          // Copy to clipboard
          navigator.clipboard.writeText(shareUrl).then(() => {
            // Show success message
            alert(`Share link copied to clipboard! You'll earn when people click: ${shareUrl}`);
          }).catch(() => {
            // Fallback for older browsers
            prompt('Copy this share link:', shareUrl);
          });
        } else {
          alert('Error creating share link: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Share error:', error);
        alert('Failed to create share link');
      });
    }

    // Blog Slider for Logged In Users
    let currentBlogSlideLoggedIn = 0;
    let blogSlidesLoggedIn = [];
    let blogSlideIntervalLoggedIn = null;

    function initBlogSliderLoggedIn() {
      console.log('Initializing logged-in blog slider...');
      const blogSlider = document.getElementById('blogSliderLoggedIn');
      if (!blogSlider) {
        console.log('Logged-in blog slider not found');
        return;
      }

      blogSlidesLoggedIn = Array.from(blogSlider.querySelectorAll('.blog-slide'));
      console.log('Found', blogSlidesLoggedIn.length, 'logged-in blog slides');
      
      if (blogSlidesLoggedIn.length === 0) return;

      // Create dots for logged-in slider
      const dotsContainer = document.getElementById('blogSliderDotsLoggedIn');
      if (dotsContainer) {
        dotsContainer.innerHTML = '';
        blogSlidesLoggedIn.forEach((_, index) => {
          const dot = document.createElement('button');
          dot.className = 'blog-slider-dot';
          dot.onclick = () => goToBlogSlideLoggedIn(index);
          dotsContainer.appendChild(dot);
        });
      }

      // Show first slide
      showBlogSlideLoggedIn(0);
      
      // Start auto-slide for logged-in users
      startBlogAutoSlideLoggedIn();
      
      // Pause on hover
      blogSlider.addEventListener('mouseenter', stopBlogAutoSlideLoggedIn);
      blogSlider.addEventListener('mouseleave', startBlogAutoSlideLoggedIn);
    }

    function showBlogSlideLoggedIn(index) {
      console.log('Showing logged-in blog slide', index);
      
      // Hide all slides
      blogSlidesLoggedIn.forEach(slide => {
        slide.style.display = 'none';
        slide.classList.remove('active');
      });
      
      // Remove active class from all dots
      const dots = document.querySelectorAll('#blogSliderDotsLoggedIn .blog-slider-dot');
      dots.forEach(dot => dot.classList.remove('active'));
      
      // Show current slide
      currentBlogSlideLoggedIn = index;
      if (blogSlidesLoggedIn[currentBlogSlideLoggedIn]) {
        blogSlidesLoggedIn[currentBlogSlideLoggedIn].style.display = 'block';
        blogSlidesLoggedIn[currentBlogSlideLoggedIn].classList.add('active');
        console.log('Showing logged-in slide', currentBlogSlideLoggedIn);
      }
      if (dots[currentBlogSlideLoggedIn]) {
        dots[currentBlogSlideLoggedIn].classList.add('active');
      }
    }
    
    function slideBlogLoggedIn(direction) {
      if (blogSlidesLoggedIn.length === 0) return;
      
      currentBlogSlideLoggedIn += direction;
      
      if (currentBlogSlideLoggedIn >= blogSlidesLoggedIn.length) {
        currentBlogSlideLoggedIn = 0;
      } else if (currentBlogSlideLoggedIn < 0) {
        currentBlogSlideLoggedIn = blogSlidesLoggedIn.length - 1;
      }
      
      showBlogSlideLoggedIn(currentBlogSlideLoggedIn);
    }
    
    function goToBlogSlideLoggedIn(index) {
      if (index >= 0 && index < blogSlidesLoggedIn.length) {
        showBlogSlideLoggedIn(index);
      }
    }
    
    function startBlogAutoSlideLoggedIn() {
      stopBlogAutoSlideLoggedIn();
      if (blogSlidesLoggedIn.length > 1) {
        blogSlideIntervalLoggedIn = setInterval(() => {
          slideBlogLoggedIn(1);
        }, 5000); // Change slide every 5 seconds
      }
    }
    
    function stopBlogAutoSlideLoggedIn() {
      if (blogSlideIntervalLoggedIn) {
        clearInterval(blogSlideIntervalLoggedIn);
        blogSlideIntervalLoggedIn = null;
      }
    }
        return;
      }
      
      // Create share URL
      const userId = <%- user ? user.id : 'null' %>;
      const shareUrl = `${window.location.origin}/blog/${slug}?ref=${userId}`;
      
      // Copy to clipboard
      navigator.clipboard.writeText(shareUrl).then(() => {
        // Show success message
        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
        btn.disabled = true;
        
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.disabled = false;
        }, 2000);
        
        // Track share
        fetch('/api/blog/share', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ postId })
        }).catch(err => console.error('Share tracking error:', err));
        
      }).catch(err => {
        console.error('Failed to copy:', err);
        alert('Failed to copy share link');
      });
    }
    
    // Initialize blog slider when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        // Only initialize the slider that exists in the DOM
        const nonLoggedInSlider = document.getElementById('blogSlider');
        const loggedInSlider = document.getElementById('blogSliderLoggedIn');
        
        if (nonLoggedInSlider) {
          console.log('Initializing non-logged-in blog slider');
          initBlogSlider();
        }
        
        if (loggedInSlider) {
          console.log('Initializing logged-in blog slider');
          initBlogSliderLoggedIn();
        }
      }, 500); // Small delay to ensure all elements are rendered
    });
  </script>
</body>
</html>
          
